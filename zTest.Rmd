---
title: "z-έλεγχος για διαφορά ποσοστών"
author: "Κώστας Κούδας"
cache: TRUE
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
```

```{r, echo=F}
rm(list = ls())
```

Στην ενότητα [Τιμή σημαντικότητας – (p-τιμή)](tTest.html#2_Τιμή_σημαντικότητας_–_(p-τιμή)) εξετάσαμε το ενδεχόμενο το ποσοστό ενός χαρακτηριστικού σε ένα συγκεκριμένο δείγμα να διαφέρει από το ποσοστό αυτού του χαρακτηριστικού στον πληθυσμό. Στην παρούσα ενότητα θα εξετάσουμε το ενδεχόμενο τα ποσοστά δύο ανεξάρτητων δειγμάτων να διαφέρουν. Συγκεκριμένα, με αφορμή τις δημοτικές εκλογές του 2023, θα συγκρίνουμε τα ποσοστά αποχής σε δύο δήμους της Ελλάδας, Κεντρικής Κερκύρας και Πατρέων.

Αρχικά, για εισάγουμε-υπολογίζουμε τα ποσοστά αποχής στους δύο αυτούς δήμους (από [εδώ](https://ekloges.ypes.gr/current/d/home/municipalities/9118/) κι [εδώ](https://ekloges.ypes.gr/current/d/home/municipalities/9134/)) γράφοντας:

```{r}
kerkSyn <- 64576
kerkApoxi <- kerkSyn-31005
kerkPos <- kerkApoxi/kerkSyn
patraSyn <- 165684
patraApoxi <- patraSyn-89715
patraPos <- patraApoxi/patraSyn
kerkPos
patraPos
```

Οπότε βρίσκουμε 0.5198681 για την Κεντρική Κέρκυρα και 0.4585174 για την Πάτρα. Ήτοι η αποχή στην Κεντρική Κέρκυρα ήταν περίπου στο 52% και στην Πάτρα 46%. Φαίνεται διαφορετικό το αποτέλεσμα. Είναι όμως; Όπως ανέκαθεν, θα δεχτούμε ότι δεν υπάρχει καμία διαφορά στα δύο ποσοστά (μηδενική υπόθεση) και θα ψάξουμε να βρούμε ποια θα είναι η πιθανότητα δεδομένου αυτού να τύχουμε δείγματα με τέτοια διαφοροποίηση. Αν μας βγει ότι με αυτή την υπόθεση θα ήταν απίθανο να τύχουμε αυτά που συναντάμε, τότε αναγκαστικά αυτή θα απορριφθεί, καθόσον οδηγεί σε μη ρεαλιστικές παραδοχές. Αν μας βγει ότι δεν είναι απίθανο να τύχουμε αυτά που συναντάμε, τότε (τι να κάνουμε;) δεν μπορούμε να απορρίψουμε την υπόθεση της ισότητας των δύο ποσοστών.

Την εν λόγω πιθανότητα θα μας την υπολογίσει η συνάρτηση `p_timiDifPos(⏳⏳⏳,👩👩👩,⏰⏰⏰,👦👦👦)`, όπου:

-   στη θέση του `⏳⏳⏳` θα γράψουμε το ένα ποσοστό, δηλαδή το `kerkPos` (0.5198681),

-   στη θέση του `👩👩👩` θα γράψουμε το μέγεθος του ενός πληθυσμού, δηλαδή το `kerkSyn` (64576),

-   στη θέση του `⏰⏰⏰` θα γράψουμε το άλλο ποσοστό, δηλαδή το `patraPos` (0.4585174) και

-   στη θέση του `👦👦👦` θα γράψουμε το μέγεθος του άλλου πληθυσμού, δηλαδή το `patraSyn` (165684).

Αυτή ορίζεται από τον κάτωθι κώδικα:

```{r}
p_timiDifPos <- function(pos1, plithos1, pos2, plithos2) {
  a <- abs(pos1-pos2)
  pos <- (pos1*plithos1+pos2*plithos2)/(plithos1+plithos2)
  s <- sqrt(pos*(1-pos)*(1/plithos1+1/plithos2))
  2-2*pnorm(a/s)
}
```

Έτσι, γράφοντας:

```{r}
p_timiDifPos(kerkPos, kerkSyn, patraPos, patraSyn)
```

εξάγεται ένα ολοστρόγγυλο μηδενικό. Αυτό σημαίνει ότι, αν θεωρήσουμε ότι τα ποσοστά αποχής σε Κεντρική Κέρκυρα και Πάτρα δεν διαφέρουν, τότε θα ήταν εντελώς απίθανο να τύχουμε τα συγκεκριμένα αποτελέσματα αποχής που βλέπουμε. Οπότε τελικά, ναι, διαφέρουν τα ποσοστά αποχής στην προκειμένη περίπτωση.

Είναι κάτι το ιδιαίτερο η περιοχή της Πάτρας έναντι όλης της υπόλοιπης Ελλάδας ή μήπως απλά διαφοροποιείται από την Κεντρική Κέρκυρα; Θα δοκιμάσουμε να συγκρίνουμε τα ποσοστά αποχής στην Πάτρα αυτή τη φορά με αυτά της Βόρειας Κέρκυρας. Συλλέγουμε δεδομένα από [εδώ](https://ekloges.ypes.gr/current/d/home/municipalities/9326/) και ακολούθως γράφουμε:

```{r}
BkerkSyn <- 19531
BkerkApoxi <- BkerkSyn-10579
BkerkPos <- BkerkApoxi/BkerkSyn
BkerkPos
```

Οπότε μάς εμφανίζεται αποχή της τάξης του 46% (0.4583483). Η διαφορά με την αποχή στην Πάτρα είναι στο 4ο δεκαδικό ψηφίο, πράγμα που μπορεί να σημαίνει ότι αυτές οι δύο περιπτώσεις δεν είχαν διαφορά. Ας το ελέγξουμε:

```{r}
p_timiDifPos(BkerkPos, BkerkSyn, patraPos, patraSyn)
```

Η p-τιμή προέκυψε 0.9642096, δηλαδή δεν είναι καθόλου απίθανο να τύχουμε αυτά που βλέπουμε, αν τα δύο ποσοστά δεν διαφέρουν. Επομένως δεν είναι δυνατόν να απορρίψουμε την υπόθεση ότι η αποχή στην Βόρεια Κέρκυρα δεν διαφέρει από την αποχή στην Πάτρα.

Συνολικά γράψαμε τον κώδικα:

```{r, eval=F}
kerkSyn <- 64576
kerkApoxi <- kerkSyn-31005
kerkPos <- kerkApoxi/kerkSyn
patraSyn <- 165684
patraApoxi <- patraSyn-89715
patraPos <- patraApoxi/patraSyn
kerkPos
patraPos
p_timiDifPos <- function(pos1, plithos1, pos2, plithos2) {
  a <- abs(pos1-pos2)
  pos <- (pos1*plithos1+pos2*plithos2)/(plithos1+plithos2)
  s <- sqrt(pos*(1-pos)*(1/plithos1+1/plithos2))
  2-2*pnorm(a/s)
}
p_timiDifPos(kerkPos, kerkSyn, patraPos, patraSyn)
BkerkSyn <- 19531
BkerkApoxi <- BkerkSyn-10579
BkerkPos <- BkerkApoxi/BkerkSyn
BkerkPos
p_timiDifPos(BkerkPos, BkerkSyn, patraPos, patraSyn)
```

