---
title: "Μέθοδος Bootstrap"
author: "Κώστας Κούδας"
cache: TRUE
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
```


Πολλές φορές χρειαζόμαστε να κάνουμε μια εκτίμηση για κάποιο στατιστικό μέγεθος ενός πληθυσμού, όπως π.χ. η τυπική του απόκλιση ή η μέση τιμή του. Ναι μεν μπορούμε να κάνουμε μια εκτίμηση για τη μέση τιμή ενός πληθυσμού (βλ. ενότητα [Εκτίμηση μέσης τιμής](ektimMean.html)), αλλά για την τυπική απόκλιση τα πράγματα διαφοροποιούνται, ενώ παράλληλα τα διαστήματα εμπιστοσύνης έχουν κάποιες παραπάνω απαιτήσεις. Και καλώς ή κακώς υπάρχουν ένα σορό στατιστικά μεγέθη. Θα είναι δύσκολο να διαχειριστούμε τη θεωρία και τις απαιτήσεις για όλα αυτά.

Εδώ θα χρησιμοποιήσουμε μία μέθοδο, η οποία έχοντας ένα δείγμα μπορεί να κάνει κάποιες εκτιμήσεις για οποιοδήποτε στατιστικό μέγεθος θέλουμε που να αφορά τον πληθυσμό. Αυτή είναι η μέθοδος Bootstrap και θα την χρησιμοποιήσουμε για να κάνουμε κάποιες εκτιμήσεις για τη μέση τιμή, τη διάμεσο, την τυπική απόκλιση και την τυπική απόκλιση των εξόδων του του Εθνικού Μουσείου Φυσικής Ιστορίας.

Τα δεδομένα αφορούν τον Ιούνιο του 2023 και τα αποθηκεύσαμε σε ένα αρχείο ονόματι foi-expenditure-over-25000-june-2023.xlsx, φούπρώτα δραγράψαμε τα προηγούμενα.


```{r}
rm(list = ls())
```

```{r echo = F, results='asis', message=FALSE}
if(!require(readxl)){
    install.packages("readxl")
    library(readxl)
}
foi_expenditure_over_25000_june_2023 <- readxl::read_excel("foi-expenditure-over-25000-june-2023.xlsx")
knitr::kable(foi_expenditure_over_25000_june_2023) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "100%", height = "200px")
```

Εμείς διαθέτουμε δεδομένα μόνο για τον Ιούνιο του 2023, όχι για όλο το 2023. Έχουμε ένα δείγμα από τα έξοδα όλου του χρόνου και θα προσπαθήσουμε να κάνουμε μια εκτίμηση για τα ετήσια. Αυτό που θα κάνουμε είναι:

-   να διαλέξουμε στην τύχη μέρα του μήνα αυτού και να καταγράψουμε τα έξοδα του μουσείου τότε,

-   να διαλέξουμε ξανά στην τύχη μέρα του μήνα αυτού (μπορεί να είναι και η προηγούμενη που διαλέξαμε) και να καταγράψουμε τα έξοδα του μουσείου τότε,

-   να διαλέξουμε στην τύχη μέρα του μήνα αυτού (ίσως ίδια με κάποια από τις προηγούμενες) και να καταγράψουμε τα έξοδα του μουσείου τότε,

-   κ.ο.κ. για 30 φορές (όσες είναι και οι ημέρες του Ιούνη)

Με αυτόν τον τρόπο σχηματίζουμε ένα σύνολο εξόδων, του οποίου θα υπολογίσουμε το στατιστικό μέγεθος που επιθυμούμε. Ξανακάνουμε αυτή τη διαδικασία μπόλικες φορές κι έτσι έχουμε μπόλικες τιμές για το στατιστικό μέγεθος που ενδιαφερόμαστε. Θα τις παρουσιάσουμε με ένα ιστόγραμμα, ώστε να δούμε πώς κατανέμονται οι τιμές του στατιστικού μας μεγέθους.

Φτιάχνουμε, λοιπόν, μια λίστα με τα έξοδα αυτού του μήνα:

```{r}
exoda <- foi_expenditure_over_25000_june_2023$Amount
```

Η συνάρτηση που θα κάνει τη δουλειά που περιγράψαμε είναι η `bootstrap_meth(📋📋📋, 🐜🐜🐜, ⚔️⚔️⚔️),` όπου:

-   στη θέση του `📋📋📋` θα βάλουμε τη λίστα με τις τιμές των δεδομένων μας,

-   στη θέση του `🐜🐜🐜` θα βάλουμε τον αριθμό των δειγματοληψιών που θέλουμε να κάνουμε (πόσες δηλαδή θέλουμε να είναι αυτές οι μπόλικες φορές) και

-   στη θέση του `⚔️⚔️⚔️` θα βάλουμε το όνομα του στατιστικού μεγέθους που μάς ενδιαφέρει.

Η συνάρτησή μας είναι η:

```{r}
bootstrap_meth <- function(dedomena, epan, stat){
  bootstrap_apotel <- c()
  n <- length(dedomena)
  for (i in 1:epan){
    deigma <- sample(dedomena, size = n, replace=TRUE)
    bootstrap_apotel[i] <- stat(deigma)
  }
  hist(bootstrap_apotel)
}
```

Οπότε για να κάνουμε μιαν εκτίμηση της μέσης τιμής των εξόδων όλου του 2023 γράφουμε:

```{r}
bootstrap_meth(exoda, 1000, mean)
```

Εδώ βάλαμε να γίνουν 1000 δειγματοληψίες και βρήκαμε ότι πιθανότατα τα μέσα ετήσια έξοδα κυμαίνονται γύρω στις £15000-£25000.

Ακολούθως γράφουμε:

```{r}
bootstrap_meth(exoda, 1000, median)
```

Βλέπουμε ότι το διάμεσο έξοδο του έτους είναι γύρω στις £2000-£3000.

Για λόγους πληρότητας της παρουσίασης θα δούμε και την τυπική απόκλιση. Γράφουμε λοιπόν:

```{r}
bootstrap_meth(exoda, 1000, sd)
```

όπερ εξάγει την παραπάνω κατανομή για τις πιθανές ετήσιες τυπικές αποκλίσεις.

Ασφαλώς, δεν είναι ανάγκη να περιοριστούμε στα στατιστικά μεγέθη που είναι ήδη ενσωματωμένα στην . Για παράδειγμα μπορούμε να κάνουμε κάποια πρόβλεψη για την ασυμετρία που επιδεικνύουν τα ετήσια έξοδα χρησιμοποιώντας τη συνάρτηση `asimetriaP()` που ορίσαμε στην υποενότητα [Συντελεστής ασυμμετρίας του Pearson](asymmetria.html#1_Συντελεστής_ασυμμετρίας_του_Pearson):

```{r}
asimetriaP <- function(v){
  3*(mean(v)-median(v))/sd(v)
}
```

Οπότε δεν έχουμε παρά να γράψουμε:

```{r}
bootstrap_meth(exoda,1000, asimetriaP)
```

Οπότε έχουμε το παραπάνω ιστόγραμμα που δίνει μιαν εικόνα περί του πώς περίπου κατανέμεται η ασυμμετρία των ετήσιων εξόδων του μουσείου.

Ολόκληρος ο κώδικάς μας είναι ο:

```{r, eval=F}
rm(list = ls())
exoda <- foi_expenditure_over_25000_june_2023$Amount
bootstrap_meth <- function(dedomena, epan, stat){
  bootstrap_apotel <- c()
  n <- length(dedomena)
  for (i in 1:epan){
    deigma <- sample(dedomena, size = n, replace=TRUE)
    bootstrap_apotel[i] <- stat(deigma)
  }
  hist(bootstrap_apotel)
}
bootstrap_meth(exoda, 1000, mean)
bootstrap_meth(exoda, 1000, median)
bootstrap_meth(exoda, 1000, sd)
asimetriaP <- function(v){
  3*(mean(v)-median(v))/sd(v)
}
bootstrap_meth(exoda,1000, asimetriaP)
```



