---
title: "Συχνότητες"
author: "Κώστας Κούδας"
cache: TRUE
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
```




# Πίνακες συχνοτήτων από πρωτογενή δεδομένα

Από την σελίδα του Τομέα Μαθηματικών ΣΕΜΦΕ ΕΜΠ αντλήσαμε τις [βαθμολογίες κάποιων φοιτητών](http://www.math.ntua.gr/~loulakis/info/probabF12SHMMY_files/ProbabSHMMY2012grades.pdf) του ΕΜΠ στο μάθημα Θεωρία Πιθανοτήτων και Στατιστική κατά την εξεταστική του Φεβρουαρίου του 2013. Τις περάσαμε σε ένα αρχείο Excel κι έχουμε διαθέσιμο το αρχείο *bathmoi.xlsx*. Αυτό το εισάγουμε στην R σύμφωνα με τις οδηγίες που έχουμε δει στην υποενότητα Αρχεία Excel (.xls, .xlsx) της [Εισαγωγή αρχείων από άλλα προγράμματα](pinakes.html#13_Εισαγωγή_αρχείων_από_άλλα_προγράμματα), αφού πρώτα διαγράψαμε ό,τι είχαμε εισάγει μέχρι τώρα στην R:

```{r}
rm(list = ls())
```

```{r echo = F, results='asis', message=FALSE}
if(!require(readxl)){
    install.packages("readxl")
    library(readxl)
}
bathmoi <- readxl::read_excel("bathmoi.xlsx")
knitr::kable(bathmoi) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "100%", height = "200px")
```

Φυσικά, οι Αριθμοί Μητρώου (στήλες `ΑΜ`) δεν έχουν κανένα στατιστικό ενδιαφέρον, οπότε θα κρατήσουμε μόνο τους βαθμούς (στήλες `BATHMOS`) γράφοντας:

```{r}
bathmoi_synolo <- c(bathmoi$BATHMOS...2,
                    bathmoi$BATHMOS...4,
                    bathmoi$BATHMOS...6,
                    bathmoi$BATHMOS...8,
                    bathmoi$BATHMOS...10,
                    bathmoi$BATHMOS...12)
```

Έτσι έχουμε μια λίστα με τις βαθμολογίες μας, ονόματι `bathmoi_synolo`. Το πλήθος τους μπορούμε να το βρούμε μέσω της συνάρτησης `length()`. Έτσι, εκτελώντας την εντολή:

```{r}
length(bathmoi_synolo)
```

διαπιστώνουμε ότι έχουμε `r length(bathmoi_synolo)` βαθμολογίες.

Βέβαια, αν το δούμε προσεκτικά τον πίνακα bathmoi, διαπιστώνουμε υπάρχουν κάποιες τιμές που δεν είναι βαθμολογίες. Είναι τα **`NA`** (*Not Avaliable*) που προέκυψαν επειδή οι δύο τελευταίες στήλες του αρχικού πίνακα είναι κοντύτερες από τις υπόλοιπες. Τα NA τα απορρίπτουμε από τη λίστα γράφοντας:

```{r}
bathmoi_synolo <- na.omit(bathmoi_synolo)
```

Έτσι έχουμε τον πίνακα `bathmoi_synolo` χωρίς τα **`NA`**. Πάμε τώρα να υπολογίσουμε πάλι το πλήθος των καταγραφών μας:

```{r}
length(bathmoi_synolo)
```

Εδώ η απάντηση είναι `r length(bathmoi_synolo)` βαθμολογίες, όπερ σημαίνει πως απορρίφθηκαν από την αρχική λίστα `bathmoi_synolo` 5 **`NA`**.

Με μια πρόχειρη ανάγνωση του πίνακα βλέπουμε ότι κάποιοι βαθμοί (πχ το 1) είναι αρκετά συχνοί και κάποιοι άλλοι (πχ το 9) αρκετά σπάνιοι. Οδηγούμεστε, λοιπόν, στους κάτωθι ορισμούς.

|                                   <mark>απόλυτη συχνότητα</mark>                                    |                                    <mark>σχετική συχνότητα</mark>                                    |
|:----------------------------------:|:----------------------------------:|
| <mark>Η **απόλυτη συχνότητα** μιας τιμής μιας μεταβλητής είναι το πλήθος των εμφανίσεών της.</mark> | <mark>Η **σχετική συχνότητα** μιας τιμής μιας μεταβλητής είναι το ποσοστό των εμφανίσεών της.</mark> |

Πώς όμως μπορούν αυτές οι συχνότητες να υπολογιστούν μέσω της; Η δουλειά θα γίνει μέσω των συναρτήσεων `table()` και `prop.table()`. Γράφοντας:

```{r}
ApolSyxnBathm <- table(bathmoi_synolo)
ApolSyxnBathm
```

έχουμε τον πίνακα απόλυτων συχνοτήτων των βαθμολογιών που καταγράψαμε. Παρατηρούμε ότι όντως ο βαθμός 1 έχει πολύ μεγάλη συχνότητα (62 φοιτητές έγραψαν μονάδα), ενώ ο 9 είναι αρκετά πιο σπάνιος (10 μόνο φοιτητές έγραψαν 9).

Για τον πίνακα σχετικών συχνοτήτων γράφουμε:

```{r}
SxetSyxnBathm <- prop.table(ApolSyxnBathm)
SxetSyxnBathm
```

Παρατηρούμε ότι τα ποσοστά δίνονται με τη μορφή δεκαδικού αριθμού (η υποδιαστολή γράφεται ως τελεία). Έτσι διαπιστώνουμε ότι η σχετική συχνότητα του βαθμού 1 είναι περίπου 0.1636, άρα το 16,36% των φοιτητών έγραψε μονάδα. Από την άλλη, το άριστα (10) έχει σχετική συχνότητα περίπου 0.0106. Επομένως μόνο το 1,06% των εξεταζομένων έγραψαν άριστα.

Οι δυνατότητες της συνάρτησης `table()` δεν σταματάνε εδώ. Γράφοντας:

```{r}
arista <- table(bathmoi_synolo>=8.5)
arista
```

προκύπτει ένας πίνακας όπου μας λέει πόσοι έγραψαν άριστα (`TRUE`=14) και πόσοι όχι (`FALSE`=365).

Ενώ αν θέλουμε αυτούς που έγραψαν λίαν καλώς δεν έχουμε παρά να γράψουμε:

```{r}
LianKalos <- table(bathmoi_synolo>=6.5 & bathmoi_synolo<8.5)
LianKalos
```

οπότε βλέπουμε ότι 45 έγραψαν λίαν καλώς και 334 κάτι άλλο (ανώτερο ή κατώτερο).

Στην περίπτωση που θέλουμε να μεταχειριστούμε τον έναν ή τον άλλον πίνακα με όσα μάθαμε στις ενότητες [Επιλογή στοιχείων πίνακα](pinakes.html#2_Επιλογή_στοιχείων_πίνακα), [Προσθήκη στοιχείων σε πίνακα](pinakes.html#3_Προσθήκη_στοιχείων_σε_πίνακα) και [Αναδιαμόρφωση πίνακα](pinakes.html#4_Αναδιαμόρφωση_πίνακα), τότε χρησιμοποιούμε τη συνάρτηση `as.data.frame.table()`. Για παράδειγμα, αν θέλουμε ν’ ασχοληθούμε με τον πίνακα απόλυτων συχνοτήτων `ApolSyxnBathm`, τότε γράφουμε:

```{r}
ASBdataframe <- as.data.frame.table(ApolSyxnBathm)
```

```{r echo = F, results='asis', message=FALSE}
knitr::kable(ASBdataframe) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "max-content", height = "200px")
```

κι έτσι έχουμε τον πίνακα στη μορφή που να μας βολεύει. Δεν είναι το ζήτημα εμφανισιακο. Απλώς έχουμε περισσότερες δυνατότητες πάνω του από προγραμματιστικής απόψεως στην R.

# Από πίνακα απόλυτων συχνοτήτων σε σχετικών

Σε πολλές περιπτώσεις μπορεί να μην έχουμε πρόσβαση στα πρωτογενή δεδομένα, στις άμεσες μετρήσεις πάνω στο δείγμα μας. Μπορεί να έχουμε απλά έναν πίνακα συχνοτήτων, όπως τον `ASBdataframe`, χωρίς όμως να έχουμε πρόσβαση στα προηγούμενα στοιχεία που τον κατασκεύασαν. Πώς μπορούμε να έχουμε τότε τον πίνακα σχετικών συχνοτήτων;

Γράφοντας:

```{r eval = F}
SxetSyxnBathm2 <- prop.table(ASBdataframe)
```

καταλήγουμε στο κάτωθι σφάλμα:

```         
Error in FUN(X[[i]], ...) : 
  only defined on a data frame with all numeric-alike variables
```

διότι, πολύ απλά, η R δεν καταλαβαίνει ότι η στήλη `Freq` του `ASBdataframe` αναπαριστά συχνότητες. Απόλυτα λογικό εκ μέρους της. Θα μπορούσε η στήλη αυτή να είναι τα ύψη από κάποιους ανθρώπους ή οτιδήποτε άσχετο με συχνότητες.

Ως εκ τούτου το βάρος της δημιουργίας του πίνακα σχετικών συχνοτήτων πέφτει πάνω μας. Αλλά δεν πρόκειται για δύσκολο εγχείρημα. Η σχετική συχνότητα είναι η απόλυτη συχνότητα δια το συνολικό πλήθος των μετρήσεων. Έτσι υπολογίζουμε αρχικά το συνολικό πλήθος των μετρήσεων προσθέτοντας απλά όλες τις συχνότητες (βλ. [Νέα λίστα](pinakes.html#22_Νέα_λίστα) και [Κατασκευή λίστας ή πίνακα τιμών στην R](pinakes.html#12_Κατασκευή_λίστας_ή_πίνακα_τιμών_στην_R)):

```{r}
athrisma <- sum(ASBdataframe$Freq)
```

και ακολούθως διαιρούμε κάθε στοιχείο της στήλης `Freq` με το `athrisma` και συγχρόνως επισυνάπτοντας την κατασκευασθείσα λίστα ως νέα στήλη ονόματι `SxetSyxn` σύμφωνα με αυτά που μάθαμε στην υποενότητα Προσθήκη στήλης της [Προσθήκη στοιχείων σε πίνακα](pinakes.html#3_Προσθήκη_στοιχείων_σε_πίνακα):

```{r}
ASBdataframe$SxetSyxn <- (ASBdataframe$Freq)/athrisma
```

Οπότε γράφοντας:

```{r, eval=F}
View(ASBdataframe)
```

έχουμε έναν πίνακα απόλυτων και σχετικών συχνοτήτων.

```{r echo = F, results='asis', message=FALSE}
knitr::kable(ASBdataframe) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "max-content", height = "200px")
```

Συνολικά ο κώδικά μας είναι ο κάτωθι:

```{r, eval =F}
rm(list = ls())
bathmoi_synolo <- c(bathmoi$BATHMOS...2,
                    bathmoi$BATHMOS...4,
                    bathmoi$BATHMOS...6,
                    bathmoi$BATHMOS...8,
                    bathmoi$BATHMOS...10,
                    bathmoi$BATHMOS...12)
length(bathmoi_synolo)
bathmoi_synolo <- na.omit(bathmoi_synolo)
length(bathmoi_synolo)
ApolSyxnBathm <- table(bathmoi_synolo)
ApolSyxnBathm
SxetSyxnBathm <- prop.table(ApolSyxnBathm)
SxetSyxnBathm
arista <- table(bathmoi_synolo>=8.5)
arista
LianKalos <- table(bathmoi_synolo>=6.5 & bathmoi_synolo<8.5)
LianKalos
ASBdataframe <- as.data.frame.table(ApolSyxnBathm)
athrisma <- sum(ASBdataframe$Freq)
ASBdataframe$SxetSyxn <- (ASBdataframe$Freq)/athrisma
View(ASBdataframe)
```

