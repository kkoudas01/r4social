---
title: "Μέτρα θέσης"
author: "Κώστας Κούδας"
cache: TRUE
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
```




Πολλές φορές μπορεί να θελήσουμε να εκφράσουμε κάποια δεδομένα με έναν μόνο αριθμό. Εδώ π.χ. θα μελετήσουμε τον αριθμό των ανθρώπων (και ειδικότερα των γυναικών) στο νομοθετικό σώμα κάθε χώρας. Τοιαύτη περιπτώσει μπορεί να ενδιαφερόμαστε να εκφράσουμε έναν ενιαίο αριθμό για όλη τη Γη που να αντιπροσωπεύει όλες τις τιμές που πραγματικά υπάρχουν. Αυτό το ένα αντιπροσωπευτικό νούμερο, αυτός ο αριθμός που εκφράζει, έστω και προσεγγιστικά, όλο το πλήθος διαφορετικών τιμών, ονομάζεται μέτρο θέσης. Υπάρχουν διάφορα μέτρα θέσης. Εδώ θα εξετάσουμε κάποια απ’ αυτά.

# Μέση τιμή

Τα δεδομένα κατεβάστηκαν από [εδώ](http://archive.ipu.org/wmn-e/classif.htm) και αποθηκεύτηκαν κατόπιν μικρής επεξεργασίας σ’ ένα αρχείο ονόματι GynPolit.xlsx, αφού πρώτα διαγράφηκαν οι μεταβλητές της προηγούμενης ενότητας.

```{r}
rm(list = ls())
```

```{r echo = F, results='asis', message=FALSE}
if(!require(readxl)){
    install.packages("readxl")
    library(readxl)
}
GynPolit <- readxl::read_excel("GynPolit.xlsx")
knitr::kable(GynPolit) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "100%", height = "200px")
```

Η μέση τιμή είναι το πρώτο και πιο γνωστό μέτρο θέσης. Αυτή έρχεται ν’ απαντήσει το ερώτημα **«αν όλα τα κοινοβούλια είχαν το ίδιο αριθμό ανθρώπων, ποιο θα ήταν αυτό;»**. Υπάρχουν διαφόρων ειδών μέσες τιμές, αυτή με την οποία θ’ ασχοληθούμε έχει και μία σημαντική πρόσθετη ιδιότητα: *Η μέση τιμή του αθροίσματος κάποιων τιμών, είναι το άθροισμα των μέσων τιμών τους.* Δηλαδή, ας υποθέσουμε ότι έχουμε ένα πλήθος ατόμων και καταμετράμε τις ώρες εργασίας τους, και έστω ότι μπορεί και να κάνουν δύο εργασίες ημερησίως. Έτσι, αν η μέση τιμή των ωρών της πρώτης εργασίας είναι 5.5 ώρες και της δεύτερης εργασίας 2.3 ώρες, τότε η μέση τιμή των ωρών εργασίας γενικώς θα είναι 5.5+2.3=7.8 ώρες. Ανακεφαλαιώνοντας:

|                                                     <mark>Μέση τιμή</mark>                                                      |
|:----------------------------------------------------------------------:|
| <mark>Αν όλες οι τιμές ήταν ίσες με έναν συγκεκριμένο αριθμό, τότε η **μέση τιμή** τους θα ήταν αυτός ακριβώς ο αριθμός.</mark> |
|               <mark>Η **μέση τιμή** του αθροίσματος κάποιων τιμών, είναι το άθροισμα των μέσων τιμών τους.</mark>               |

Για να υπολογίσουμε τη μέση τιμή κάποιων δεδομένων στην R θα πρέπει να έχουμε αυτά τα δεδομένα μας σε μορφή λίστας.

Αρχικά όμως, επειδή κάποιες χώρες έχουν δύο νομοθετικά σώματα (Κάτω Βουλή και Γερουσία), θα φτιάξουμε έναν πίνακα με το σύνολο των νομοθετών και στα δύο σώματα. Προς τούτο θα αθροίσουμε τους νομοθέτες κάθε βουλής (Άνω και Κάτω) και θα φτιάξουμε έτσι αυτόν τον νέο πίνακα, ο οποίος θα ονομαστεί `nomothetes`. Αυτό θα γίνει μέσω της συνάρτησης `aggregate()` ως εξής:

```{r}
nomothetes <- aggregate(THESEIS ~ XORA, GynPolit, sum)
```

Οπότε έτσι αθροίζουμε (`sum`) τις τιμές της στήλης `THESEIS`, οι οποίες έχουν την ίδια ένδειξη στην στήλη `XORA`.

Η μέση τιμή αυτών υπολογίζεται μέσω της συνάρτησης `mean()` γράφοντας:

```{r}
mean(nomothetes$THESEIS)
```

οπότε εξάγεται ο αριθμός `r mean(nomothetes$THESEIS)` ως η μέση τιμή των αριθμών της λίστας `nomothetes$THESEIS`.

Έχει πραγματικό ενδιαφέρον να απεικονιστεί η μέση τιμή που βρήκαμε στο ιστόγραμμα απόλυτων συχνοτήτων. Αυτό, κατά τα γνωστά, θα σχεδιαστεί γράφοντας:

```{r}
if(!require(ggplot2)){
    install.packages("ggplot2")
    library(ggplot2)
}
NTh_hist <- ggplot(nomothetes, aes(x=THESEIS))
NTh_hist + geom_histogram(bins = 25)
```

Για να τοποθετηθεί σε αυτό και μία γραμμή που θα δείχνει την μέση τιμή που βρήκαμε θα γράψουμε:

```{r}
NTh_hist +
  geom_histogram(bins = 25) +
  geom_vline(aes(xintercept = mean(THESEIS)))
```

Μορφολογικά στοιχεία αυτής μπορούν να επεξεργαστούν γράφοντας εναλλακτικά:

```{r}
NTh_hist +
  geom_histogram(bins = 25) +
  geom_vline(aes(xintercept = mean(THESEIS)),linetype = "dashed", linewidth = 0.6)
```

Όσον αφορά την σημασία αυτής της γραμμής στο ιστόγραμμα, θ’ ασχοληθούμε με μια διαδικασία ισορροπίας. Θα φτιάξουμε ένα ξύλινο αντίγραφο του ιστογράμματος και θα το τοποθετήσουμε σε μια τραμπάλα. Για να ισορροπεί το καλλιτέχνημα μας, δηλαδή να μην γέρνει η τραμπάλα προς τη μία ή την άλλη μεριά, θα πρέπει το ιστόγραμμα να τοποθετηθεί έτσι, ώστε η γραμμή της μέσης τιμής να πέφτει πάνω ακριβώς στο σημείο περιστροφής της τραμπάλας.

![](wooden%20hist.jpg){width="30%"}

Ας υποθέσουμε τώρα ότι λόγω κάποιων αυτονομιστικών κινημάτων προέκυψαν 30 νέες χώρες, οι οποίες έχουν όλες τον ίδιο αριθμό νομοθετών. Αυτό σημαίνει ότι μια νέα μπάρα ύψους 30 θα προστεθεί στις ήδη υπάρχουσες, δίπλα τους ή πάνω από κάποια, αναλόγως από τον αριθμό των νομοθετών που καθεμία από αυτές τις 30 θα έχει.

Από την Φυσική και από την εμπειρία μας γνωρίζουμε, ότι όσο μακρύτερα από το σημείο περιστροφής ασκείται μια δύναμη, τόσο μεγαλύτερη επίδραση έχει αυτή στη διατάραξη της ισορροπίας. Αυτό σημαίνει ότι όσο πιο απομακρυσμένη είναι η νέα μπάρα από την προηγούμενη θέση ισορροπίας, τόσο περισσότερο θα την επηρεάσει. Με άλλα λόγια, όσο πιο απομακρυσμένο είναι το πλήθος των νομοθετών στις νέες αυτές χώρες από την μέση τιμή που είχαμε πριν, τόσο πιο μεγάλη θα είναι και η αλλαγή στην νέα μέση τιμή (νέα θέση ισορροπίας).

Αυτά μας οδηγούν στο συμπέρασμα ότι η μέση τιμή όχι μόνο επηρεάζεται από ακραίες τιμές, αλλά επηρεάζεται τόσο εντονότερα, όσο πιο ακραίες είναι αυτές. Αυτό μπορεί κάποιες φορές να είναι επιθυμητό σαν αποτύπωμα (πχ στον υπολογισμό της μέσης επίδοσης ενός μαθητή) κάποιες φορές μπορεί αυτό να είναι ανεπιθύμητο. Στα πλαίσια αυτά υπάρχει η επιλογή `trim =`. Έτσι, γράφοντας:

```{r}
mean(nomothetes$THESEIS, trim = 0.2)
```

απορρίπτουμε από τον υπολογισμό της μέσης τιμής το πρώτο και το τελευταίο 20% (`=0.2`) των τιμών. Εδώ που είχαμε `r length(nomothetes$THESEIS)` τιμές, θα απορριφθούν οι 0.2•`r length(nomothetes$THESEIS)`=`r 0.2*length(nomothetes$THESEIS)`≈`r round(0.2*length(nomothetes$THESEIS))` αρχικές και οι `r round(0.2*length(nomothetes$THESEIS))` τελικές χώρες, αν διαταχθούν σε αύξουσα σειρά με βάσει το πλήθος των νομοθετών τους.

# Διάμεσος

Η διάμεσος είναι ένα άλλο μέτρο θέσης. Υπό μία έννοια ίσως να είναι πιο δίκαιο από την μέση τιμή, αφού δεν επηρεάζεται από τις ακραίες τιμές.

|                                                                         <mark>Διάμεσος</mark>                                                                         |
|:----------------------------------------------------------------------:|
| <mark>Η **διάμεσος** ενός δείγματος (ή πληθυσμού) είναι ο αριθμός πάνω από τον οποίο είναι οι μισές τιμές του δείγματος και κάτω από τον οποίο οι άλλες μισές.</mark> |

Έτσι, όταν πχ η σελίδα [worlddata.info](https://www.worlddata.info/average-income.php) γράφει ότι το διάμεσο μηνιαίο εισόδημα στην Ελλάδα του 2015 ήταν 1693€, εννοεί ότι οι μισοί Έλληνες είχαν πάνω από 1693€ μηνιάτικο και οι άλλοι μισοί κάτω από 1693€.

Ας πάμε τώρα ξανά στον πίνακα `nomothetes` και στην στήλη του `THESEIS`. Αν θέλουμε να υπολογίσουμε την διάμεσο της στήλης αυτής θα χρησιμοποιήσουμε την συνάρτηση `median()` γράφουμε:

```{r}
median(nomothetes$THESEIS)
```

οπότε βρίσκουμε `r median(nomothetes$THESEIS)`, πράγμα που σημαίνει ότι οι μισές χώρες έχουν πάνω από `r median(nomothetes$THESEIS)` νομοθέτες και οι άλλες μισές κάτω από `r median(nomothetes$THESEIS)`.

Στην περίπτωση που θελήσουμε να αποτυπωθεί η ένδειξη της διαμέσου στο ιστόγραμμα απόλυτων συχνοτήτων, τότε παρόμοια με την περίπτωση της μέσης τιμής γράφουμε:

```{r}
NTh_hist +
  geom_histogram(bins = 25) +
  geom_vline(aes(xintercept = median(THESEIS)))
```

Η γραμμή αυτή χωρίζει το ιστόγραμμα σε δύο ισοεμβαδικά τμήματα.

![](painted%20hist.jpg){width="30%"}

# Τεταρτημόρια – Ποσοστημόρια

Αν θέλουμε μια δόση πληροφορίας παραπάνω, θα απευθυνθούμε στα τεταρτημόρια.

|                                                                                         <mark>Τεταρτημόρια</mark>                                                                                          |
|:----------------------------------------------------------------------:|
|                  <mark>**Πρώτο τεταρτημόριο** ενός συνόλου μετρήσεων (δείγματος ή πληθυσμού) είναι η τιμή κάτω από την οποία είναι το 25% των τιμών και πάνω από την οποία το 75%.</mark>                  |
| <mark>**Δεύτερο τεταρτημόριο** ενός συνόλου μετρήσεων (δείγματος ή πληθυσμού) είναι η τιμή κάτω από την οποία είναι το 50% των τιμών και πάνω από την οποία το 50%. Με άλλα λόγια είναι η διάμεσος.</mark> |
|                  <mark>**Τρίτο τεταρτημόριο** ενός συνόλου μετρήσεων (δείγματος ή πληθυσμού) είναι η τιμή κάτω από την οποία είναι το 75% των τιμών και πάνω από την οποία το 25%.</mark>                  |

Για να βρούμε τα τεταρτημόρια στην R θα χρησιμοποιήσουμε την συνάρτηση `quantile()`. Έτσι, γράφοντας:

```{r}
quantile(nomothetes$THESEIS)
```

εξάγονται οι αριθμοί `r quantile(nomothetes$THESEIS)[[1]]`, `r quantile(nomothetes$THESEIS)[[2]]`, `r quantile(nomothetes$THESEIS)[[3]]` και `r quantile(nomothetes$THESEIS)[[5]]`. Αυτοί μας λένε ότι οι τιμές αρχίζουν από το `r quantile(nomothetes$THESEIS)[[1]]`, τελειώνουν στο `r quantile(nomothetes$THESEIS)[[4]]` και ότι το πρώτο τεταρτημόριο είναι `r quantile(nomothetes$THESEIS)[[2]]`, το δεύτερο (διάμεσος) `r quantile(nomothetes$THESEIS)[[3]]` και το τρίτο `r quantile(nomothetes$THESEIS)[[4]]`.

|                                                                            <mark>Ποσοστημόρια</mark>                                                                             |
|:----------------------------------------------------------------------:|
| <mark>**Το q ποσοστημόριο** ενός συνόλου μετρήσεων (δείγματος ή πληθυσμού) είναι η τιμή κάτω από την οποία είναι το 100q% των μετρήσεων και πάνω από την οποία το (1-q)%.</mark> |

Για να βρούμε τα ποσοστημόρια στην θα χρησιμοποιήσουμε πάλι την συνάρτηση `quantile()`. Έτσι, γράφοντας:

```{r}
quantile(nomothetes$THESEIS, probs = c(0.1,0.75))
```

βρίσκουμε τις τιμές κάτω από τις οποίες είναι το χαμηλότερο 0.1•100%=10% και αυτές κάτω από τις οποίες είναι το χαμηλότερο 0.75•100%=75%.

Ανακεφαλαιώνοντας, έχουμε τον κώδικα αυτόν συνολικά:

```{r, eval=F}
rm(list = ls())
nomothetes <- aggregate(THESEIS ~ XORA, GynPolit, sum)
mean(nomothetes$THESEIS)
if(!require(ggplot2)){
    install.packages("ggplot2")
    library(ggplot2)
}
NTh_hist <- ggplot(nomothetes, aes(x=THESEIS))
NTh_hist + geom_histogram(bins = 25)
NTh_hist +
  geom_histogram(bins = 25) +
  geom_vline(aes(xintercept = mean(THESEIS)))
NTh_hist + geom_histogram(bins = 25) + geom_vline(aes(xintercept = mean(THESEIS)),linetype = "dashed", linewidth = 0.6)
mean(nomothetes$THESEIS, trim = 0.2)
median(nomothetes$THESEIS)
NTh_hist +
  geom_histogram(bins = 25) +
  geom_vline(aes(xintercept = median(THESEIS)))
quantile(nomothetes$THESEIS)
quantile(nomothetes$THESEIS, probs = c(0.1,0.75))
```

# Επικρατούσα τιμή

Η επικρατούσα τιμή είναι ένα άλλο μέτρο θέσης ανεξάρτητο από ακραίες τιμές.

|                                          <mark>Επικρατούσα τιμή</mark>                                           |
|:----------------------------------------------------------------------:|
| <mark>**Επικρατούσα τιμή** κάποιων μετρήσεων (δείγματος ή πληθυσμού) είναι η πιο συχνά εμφανιζόμενη τιμή.</mark> |

Στο παράδειγμα με τους νομοθέτες όλες οι τιμές είναι διαφορετικές. Οπότε δεν υπάρχει κάποια πιο συχνά εμφανιζόμενη από τις άλλες. Συνεπώς θα πάμε σ’ ένα άλλο παράδειγμα. Θα αντλήσουμε πληροφορίες από την σελίδα [αυτή](https://www.key-shortcut.com/en/writing-systems/world-map-of-alphabets-scripts) σχετικά με τις γλώσσες και τα αλφάβητα που χρησιμοποιούνται από κάθε χώρα και τις οποίες θα αντιγράψουμε σ’ ένα αρχείο ονόματι GlossesAlphabita.xlsx.

```{r}
rm(list = ls())
```

```{r echo = F, results='asis', message=FALSE}
if(!require(readxl)){
    install.packages("readxl")
    library(readxl)
}
GlossesAlphabita <- readxl::read_excel("GlossesAlphabita.xlsx")
knitr::kable(GlossesAlphabita) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "scroll_box", height = "200px")
```

Η R δεν έχει έτοιμη συνάρτηση για τον υπολογισμό της επικρατούσας τιμής, οπότε θα φτιάξουμε εμείς μία, την οποία θα ονομάσουμε `Modes()`.

```{r}
Modes <- function(x) {
ux <- unique(x)
tab <- tabulate(match(x, ux))
ux[tab == max(tab)]}
```

Ακολούθως γράφουμε:

```{r}
Modes(GlossesAlphabita$`Official language`)
```

για να βρούμε την πιο συχνά εμφανιζόμενη γλώσσα (βρίσκουμε τα αγγλικά). Εννοείται πως μιλάμε σε επίπεδο χωρών κι όχι ανθρώπων που την ομιλούν. Επίσης γράφουμε:

```{r}
Modes(GlossesAlphabita$`Writing system`)
```

για να βρούμε το πιο συχνά εμφανιζόμενο αλφάβητο (βρίσκουμε τη λατινική γραφή).

Φυσικά, αν υπήρχαν παραπάνω από μία γλώσσες εξίσου διαδεδομένες και πιο συχνά εμφανιζόμενες από τις άλλες, θα είχαμε δύο επικρατούσες τιμές, τις οποίες θα εμφάνιζε αυτός ο κώδικας.

Ανακεφαλαιώνοντας έχουμε τον κώδικα:

```{r, eval =F}
rm(list = ls())
Modes <- function(x) {
ux <- unique(x)
tab <- tabulate(match(x, ux))
ux[tab == max(tab)]}
Modes(GlossesAlphabita$`Official language`)
Modes(GlossesAlphabita$`Writing system`)
```

