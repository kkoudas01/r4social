---
title: "t-έλεγχος για το ποσοστό"
author: "Κώστας Κούδας"
cache: TRUE
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
```

# Γενικά

Υπάρχουν περιπτώσεις όπου παρατηρούμε κάτι ξεχωριστό να συμβαίνει σ’ ένα τμήμα ενός πληθυσμού. Εδώ, για παράδειγμα, θα μελετήσουμε το τμήμα του πληθυσμού των ΗΠΑ που είναι οι θανατοποινίτες, και θα εξετάσουμε αν σε αυτό το δείγμα το ποσοστό των λευκών είναι διαφορετικό από το ποσοστό των λευκών στις ΗΠΑ. Τι εννοούμε όμως «διαφορετικό»; Από τη σελίδα United States Census Bureau [βλέπουμε](https://www.census.gov/quickfacts/fact/table/US#) ότι το ποσοστό των λευκών στις ΗΠΑ είναι 75.5%. Είναι λογικό, αν το ποσοστό των λευκών στους θανατοποινίτες είναι 76% ή 74%, να θεωρήσουμε ότι δεν συμβαίνει κάτι το αξιοπρόσεκτο στις θανατικές ποινές. Επίσης, όμως, είναι λογικό να υποψιαστούμε ότι κάτι ξεχωριστό συμβαίνει με τις θανατικές ποινές, αν το ποσοστό των λευκών βγει 20% στους θανατοποινίτες.

Προς τούτο συγκεντρώσαμε στοιχεία από τη σελίδα Death Penalty Information Center για τις θανατικές ποινές στα έτη 2020-2022 ([1](https://deathpenaltyinfo.org/facts-and-research/sentencing-data/death-sentences-by-year/2020-death-sentences-by-name-race-and-county) , [2](https://deathpenaltyinfo.org/facts-and-research/sentencing-data/death-sentences-by-year/2021-death-sentences-by-name-race-and-county) και [3](https://deathpenaltyinfo.org/facts-and-research/sentencing-data/death-sentences-by-year/2022-death-sentences-by-name-race-and-county)) στο φύλλο deathPop.xlsx, αφού πρώτα διαγράψαμε ό,τι είχαμε εισάγει μέχρι τώρα στην R:

```{r}
rm(list = ls())
```

```{r echo = F, results='asis', message=FALSE}
if(!require(readxl)){
    install.packages("readxl")
    library(readxl)
}
deathPop <- readxl::read_excel("deathPop.xlsx")
knitr::kable(deathPop) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "100%", height = "300px")
```

+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| <mark>μηδενική και εναλλακτική υπόθεση</mark>                                                                                                                        |
+======================================================================================================================================================================+
| -   <mark>Την άποψη που λέει πως τίποτα το ξεχωριστό δε συμβαίνει την ονομάζουμε **μηδενική υπόθεση** και την συμβολίζουμε με $\boldsymbol{\mathcal{H}_0}$.</mark> – |
|                                                                                                                                                                      |
| -   <mark>Την άποψη που λέει ότι έχουμε κάτι το ξεχωριστό την ονομάζουμε **εναλλακτική υπόθεση** και τη συμβολίζουμε με $\boldsymbol{\mathcal{H}_1}$.</mark>         |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Έτσι, εν προκειμένω η $\boldsymbol{\mathcal{H}_0}$ είναι η υπόθεση ότι το 75.5% των θανατοποινιτών είναι λευκοί, όσο δηλαδή το ποσοστό τους στον πληθυσμό των ΗΠΑ, ενώ η $\boldsymbol{\mathcal{H}_1}$ ισχυρίζεται ότι τα δύο ποσοστά διαφέρουν.

# Τιμή σημαντικότητας – (p-τιμή)

Αρχικά βρίσκουμε πόσοι έχουν καταδικαστεί σε θάνατο τα έτη 2020-2022 γράφοντας:

```{r}
length(deathPop$`Last Name`)
```

Βρίσκουμε ότι καταδικάστηκαν 56 άτομα. Επίσης, γράφοντας:

```{r}
nrow(deathPop[deathPop$`Race of Defendant`== "White", ])
```

βρίσκουμε ότι είχαμε 27 λευκούς καταδικασμένους εις θάνατον. Αυτό σημαίνει ότι η αναλογία:

$$\dfrac{\lambda\varepsilon\upsilon\kappa o\iota \ \ \theta\alpha\nu\alpha\tau o \pi o \iota\nu\iota\tau\varepsilon\varsigma}{\sigma \upsilon\nu o \lambda o \ \ \theta\alpha\nu\alpha\tau o \pi o \iota\nu\iota\tau\omega\nu}=\dfrac{27}{56}\approx 0.4821429.$$

Δηλαδή βρήκαμε ότι το 48.21% των θανατοποινιτών είναι λευκοί. Πόσο πιθανό είναι να τύχουμε κάτι τόσο ακραίο σε έναν πληθυσμό με αναλογία λευκών 75.5%; Πόσο πιθανόν είναι να διαλέξουμε δείγματα ανθρώπων με ποσοστό λευκών τουλάχιστον τόσο απόμακρο από το 75.5% όσο είναι και το 48.21%; Σε αυτό θα μας απαντήσει η συνάρτηση `p_timiPos(🍺🍺🍺,🏺🏺🏺,👨👨👨)`.

-   Στη θέση του `🍺🍺🍺` γράφουμε το ποσοστό του δείγματος που βρήκαμε, δηλαδή εδώ το 0.4821429,

-   στη θέση του `🏺🏺🏺` γράφουμε το ποσοστό που εμφανίζεται στον πληθυσμό, άρα το 0.755 στην παρούσα περίπτωση και

-   στη θέση του `👨👨👨` γράφουμε το μέγεθος του δείγματος, δηλαδή εν προκειμένω το 56.

Έχουμε λοιπόν:

```{r}
p_timiPos <- function(posYpothesis, posPlithismos, plithos) {
  a <- abs(posPlithismos-posYpothesis)
  s <- sqrt(posPlithismos*(1-posPlithismos)/plithos)
  2-2*pt(a/s,plithos-1)
}
```

Έτσι, γράφοντας:

```{r}
p_timiPos(0.4821429, 0.755, 56)
```

εξάγεται η τιμή 1.510691e-05. Δηλαδή, η πιθανότητα να τύχουμε τόσο μεγάλη απόκλιση από την πληθυσμιακή αναλογία του 75.5% είναι $1.510691\cdot 10^{-5}=0.00001510691$. Με άλλα λόγια, η όποια βεβαιότητα που μπορούμε να έχουμε για το ότι θα τύχουμε ένα τόσο σπάνιο δείγμα είναι 0.0015%. Αυτό, φυσικά, απέχει παρασάγγας από το να είναι βεβαιότητα. Το να τύχουμε δείγμα τουλάχιστον τόσο απόμακρο από την πληθυσμιακή αναλογία είναι απίθανο στα όρια του εξωπραγματικού. Επομένως διαπιστώνουμε ότι κάτι ξεχωριστό συμβαίνει εδώ. Δηλαδή η μηδενική υπόθεση δεν μπορεί να υποστηρίξει την ύπαρξη δειγμάτων σαν αυτό που μελετήσαμε ή με ακόμα μικρότερη αναλογία κι έτσι αποδεχόμαστε την εναλλακτική υπόθεση. Η τιμή $1.510691\cdot 10^{-5}$ που βρήκαμε ονομάζεται p-τιμή του στατιστικού ελέγχου υπόθεσης που κάναμε.

+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| <mark>τιμή σημαντικότητας – (p-τιμή)</mark>                                                                                                                                                                                                                                                                                                                                                                                |
+:==========================================================================================================================================================================================================================================================================================================================================================================================================================:+
| <mark>Έστω ένας έλεγχος υποθέσεων με μηδενική υπόθεση $\boldsymbol{\mathcal{H}_0}$ κι ένα δείγμα με κάποιο στατιστικό του μέγεθος υπολογισμένο (μέση τιμή, κάποια αναλογία κ.τ.λ.). Διαλέγουμε ένα δείγμα του πληθυσμού στην τύχη και υπολογίζουμε το ίδιο στατιστικό μέγεθος. Η πιθανότητα να προκύψει τιμή τουλάχιστον τόσο ακραία, όσο κι αυτή που βρήκαμε πριν ονομάζεται **τιμή σημαντικότητας** ή **p-τιμή**.</mark> |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Βρήκαμε ότι όντως η αναλογία των λευκών στους θανατοποινίτες είναι διαφορετική από την πληθυσμιακή αναλογία, δηλαδή ότι είναι λιγότερο πιθανό ένας λευκός να καταλήξει θανατοποινήτης. Όμως, προσοχή! Δεν λέμε πόσο πιθανόν είναι κάποιος *κατηγορούμενος* να καταλήξει θανατοποινήτης, αλλά πόσο πιθανόν είναι κάποιος τυχαίος αμερικάνος πολίτης να καταλήξει θανατοποινήτης. Αυτό σημαίνει ότι κάποιος μπορεί να ερμηνεύσει τα παραπάνω συμπεράσματα ως το ότι οι λευκοί δεν έχουν τόσο μεγάλη τάση προς τα ακραία εγκλήματα που επισείουν την ποινή του θανάτου, παρά στο ότι ότι η αμερικανική δικαιοσύνη είναι μεροληπτική υπέρ των λευκών.

Αυτά είναι ζητήματα που δεν μπορούν να απαντηθούν μόνο από τον στατιστικό έλεγχο που κάναμε. Θα χρειαστούμε ενδεχομένως μια στατιστική έρευνα που να συγκρίνει τα ποσοστά των λευκών και των μαύρων κατηγορουμένων που κατέληξαν σε θάνατο, πόσο συχνά στην κάθε φυλή η εισαγγελεία πρότεινε για το ίδιο έγκλημα την ποινή του θανάτου κ.τ.λ. Και, φυσικά, η Στατιστική είναι μόνο η αρχή. Η Ιστορία και η Κοινωνιολογία θα πρέπει να μας παρέχουν προσανατολισμό και αξιολόγηση των ευρημάτων μας.

# Επίπεδο σημαντικότητας – (α-τιμή)

Μία άλλη προσέγγιση είναι το να προσδιορίσουμε εκ των προτέρων το τι θεωρούμε σπάνιο δείγμα. Είναι αυτό που εμφανίζεται στο 1% των δειγμάτων ή μήπως στο 1‰; Σε επίπεδο κοινωνιολογικών ερευνών θα λέγαμε ότι αρκεί το 5%. Δηλαδή οτιδήποτε εμφανίζεται λιγότερο από το 5% των περιπτώσεων μπορεί να θεωρηθεί ως σπάνιο και πρακτικά μη ρεαλιστικό. Επομένως ένα ενδεχόμενο με πιθανότητα μικρότερη του 0.05 θα πρέπει να απορριφθεί ως απίθανο.

Κατά συνέπεια, αν, δεχόμενοι την μηδενική υπόθεση, ακραία δείγματα σαν και το δικό μας σπανίζουν, δηλαδή αν το δείγμα που τύχαμε ανήκει στο σπάνιο 5% των ακραίων τιμών, στο ακραίο 5% που η $\boldsymbol{\mathcal{H}_0}$ θεωρεί σπάνιο, τότε πρέπει ν’ απορρίψουμε την $\boldsymbol{\mathcal{H}_0}$, αφού αυτή δεν αναγνωρίζει ένα γεγονός καθόλα υπαρκτό.

|                                                                                         <mark>επίπεδο σημαντικότητας – (α)</mark>                                                                                          |
|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
| <mark>Η τιμή πιθανότητας την οποία θεωρούμε μικρή, ότι αντιπροσωπεύει κάτι σπάνιο, την ονομάζουμε **επίπεδο σημαντικότητας** και την συμβολίζουμε με **α**. Στις κοινωνικές επιστήμες μπορούμε να παίρνουμε α=0.05.</mark> |

Ποιες είναι λοιπόν οι πιο μικρές τιμές που μπορούν να πάρουν οι δειγματικές αναλογίες και που το μέγεθός τους τις κατατάσσει στο σπανιότερο 5% όλων των δειγμάτων ενός πληθυσμού με πληθυσμιακή αναλογία 75.5%; Από ποιο σημείο και κάτω είναι εξαιρετικά αμφίβολο (με πιθανότητα κάτω του 0.05) να τύχουμε δείγμα από έναν τέτοιο πληθυσμό; Ψάχνουμε λοιπόν την περιοχή του 5% των μικρότερων τιμών.

Αυτή τη φορά η δουλειά θα γίνει με τη βοήθεια της συνάρτησης `a_timiPos(🏺🏺🏺,👨👨👨, 👑👑👑)`.

-   Στη θέση του `🏺🏺🏺` γράφουμε το ποσοστό που εμφανίζεται στον πληθυσμό, άρα το 0.755 στην παρούσα περίπτωση,

-   στη θέση του `👨👨👨` γράφουμε το μέγεθος του δείγματος, δηλαδή εν προκειμένω το 56 και

-   στη θέση του `👑👑👑` θα πάει το ποσοστό που θεωρούμε ότι αντιπροσωπεύει τα σπάνια συμβάντα, το οποίο σε μας είναι το 5%, δηλαδή το 0.05.

Έχουμε λοιπόν:

```{r}
a_timiPos<- function(posPlithismos, plithos, spaniotita) {
  s <- sqrt(posPlithismos*(1-posPlithismos)/plithos)
  a <- spaniotita/2
  t <- qt(a, plithos-1, lower.tail=F)
  m1 <- posPlithismos-t*s
  m2 <- posPlithismos+t*s
  c(m1, m2)
}
```

Ακολούθως εκτελούμε την εντολή:

```{r}
a_timiPos(0.755, 56, 0.05)
```

Οπότε βρίσκουμε πως οποιοδήποτε ποσοστό κάτω από 0.6398219 (63.98%) και οποιοδήποτε ποσοστό πάνω από 0.8701781 (87.02%) θεωρείται εξαιρετικά σπάνιο ενδεχόμενο κι ως εκ τούτου δηλώνει ότι κάτι το ξεχωριστό συμβαίνει.

Παρατηρούμε ότι η δικιά μας περίπτωση, το 48.21% ξεφεύγει ήδη πολύ, από τα επιτρεπτά πλαίσια που οριοθετούν το σύνηθες από το σπάνιο. Ως εκ τούτου διαπιστώνουμε και πάλι (βλ. προηγούμενη ενότητα [Τιμή σημαντικότητας – (p-τιμή)]) ότι κάτι το ξεχωριστό συμβαίνει στην περίπτωση των θανατοποινιτών, όσον αφορά τους λευκούς. Αυτό που μάς εκπλήσσει είναι ότι δεν θεωρούνται ύποπτες οι αναλογίες των λευκών της τάξης του 65%. Είναι αυτό δυνατόν; Αυτό το μεγάλο εύρος «φυσιολογικών» ποσοστών οφείλεται στο μικρό μέγεθος που πήραμε. Ενδεικτικά, αν το δείγμα μας αποτελούνταν από 500 άτομα κι όχι από 56, τότε ο υπολογισμός:

```{r}
a_timiPos(0.755, 500, 0.05)
```

θα μας έδινε ότι οι συνήθεις αναλογίες λευκών είναι ανάμεσα στα ποσοστά 71.72% και 79.28%,άρα ότι θα πρέπει να «μας χτυπάει το καμπανάκι» ότι κάτι περίεργο συμβαίνει, όταν είμαστε έξω από αυτά τα πλαίσια. Παρατηρούμε ότι τα όρια του «φυσιολογικού» και αναμενόμενου έχουν στενέψει αρκετά από πριν λόγω αυτής της αύξησης του μεγέθους του δείγματος.

Συνολικά ο κώδικάς μας ήταν ο κάτωθι:

```{r, eval=F}
rm(list = ls())
length(deathPop$`Last Name`)
nrow(deathPop[deathPop$`Race of Defendant`== "White", ])
p_timiPos <- function(posYpothesis, posPlithismos, plithos) {
  a <- abs(posPlithismos-posYpothesis)
  s <- sqrt(posPlithismos*(1-posPlithismos)/plithos)
  2-2*pt(a/s,plithos-1)
}
p_timiPos(0.4821429, 0.755, 56)
a_timiPos<- function(posPlithismos, plithos, spaniotita) {
  s <- sqrt(posPlithismos*(1-posPlithismos)/plithos)
  a <- spaniotita/2
  t <- qt(a, plithos-1, lower.tail=F)
  m1 <- posPlithismos-t*s
  m2 <- posPlithismos+t*s
  c(m1, m2)
}
a_timiPos(0.755, 56, 0.05)
a_timiPos(0.755, 500, 0.05)
```



