---
title: "Πρόβλεψη χρονοσειρών με μοντέλα ARIMA"
author: "Κώστας Κούδας"
cache: TRUE
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
```

```{r, echo=F}
rm(list = ls())
```

Στο παρόν άρθρο θ’ ασχοληθούμε με τις ετήσιες ώρες εργασίας στην Ελλάδα στα έτη 1951-2017.

Τα δεδομένα αντλήθηκαν από τη σελίδα [Our World in Data](https://ourworldindata.org/) και αποθηκεύτηκαν σ’ ένα αρχείο ονόματι workingHours.csv. Παρακάτω παρουσιάζουμε τις 100 πρώτες γραμμές του πίνακα.

```{r echo = F, results='asis', message=FALSE}
workingHours <- read.csv("workingHours.csv")
knitr::kable(head(workingHours, n=100)) %>%
kable_styling("striped", full_width = F) %>%
scroll_box(width = "max-content", height = "200px")
```

Θα επιχειρήσουμε να κάνουμε κάποια πρόβλεψη περί του πόσες θα είναι οι ώρες στα επόμενα 5 έτη. Υπάρχουν διάφορα μοντέλα πρόβλεψης, μοντέλα αυτοπαλινδρόμησης (AR), μοντέλα κινητού μέσου όρου (MA), αυτοπαλινδρομικά μοντέλα κινητού μέσου όρου (ARMA και ARIMA) κτλ. Εδώ θ’ ασχοληθούμε με το μοντέλο ARIMA.

Αρχικά κρατάμε τη στήλη με τις ώρες εργασίας στην Ελλάδα:

```{r}
ergasiaGr <- workingHours[workingHours$Code == "GRC", 4]
```

Ακολούθως τη μετατρέπουμε σε χρονοσειρά:

```{r}
ergasiaGr_ts <- ts(ergasiaGr, start = 1951, frequency =1)
```

Στα επόμενα θα χρειαστούμε και πάλι το πακέτο `forecast`, οπότε γράφουμε πρώτα:

```{r, message=F}
if(!require(forecast)){
	install.packages("forecast")
	library(forecast)
}
```

Ακολούθως γράφουμε:

```{r}
ergasiaGr_arima <- auto.arima(ergasiaGr_ts, trace = TRUE)
```

Και πλέον μπορούμε να κάνουμε τις προβλέψεις μας. Γράφουμε:

```{r}
forecast(ergasiaGr_arima, 5)
```

Βλέπουμε ότι, όσον αφορά το έτος 2018, προβλέπουμε ότι οι μέσες ετήσιες ώρες εργασίας θα είναι 2012.416 (`Forecast`). Φυσικά αυτό δεν σημαίνει ότι κόβουμε το χέρι μας ότι έτσι θα έχουν τα πράγματα. Γι’ αυτό κι εξετάζουμε και κάποιες πιθανότητες επιπλέον. Αναλυτικότερα, μπορούμε να είμαστε 95% σίγουροι ότι οι ετήσιες ώρες εργασίας το 2018 θα είναι μεταξύ των 1985.348 (`Lo 95`) και 2039.484 (`Hi 95`), ενώ μπορούμε να είμαστε 80% σίγουροι ότι οι ετήσιες ώρες εργασίας θα είναι μεταξύ των 1994.717 (`Lo 80`) και 2030.115 (`Hi 80`). Αντίστοιχα πράγματα μπορούμε να πούμε και για τα έτη 2019-2022.

Αυτά μπορούμε να τα δούμε και γραφικά εκτελώντας τις εντολές:

```{r}
autoplot(forecast(ergasiaGr_arima, 5))
```

Η κεντρική μπλε γραμμή δείχνει την πρόβλεψη που κάνουμε. Όπως όμως είπαμε αυτή απέχει παρασάγγας από το να είναι βεβαιότητα. Γι’ αυτό θέλουμε και να απεικονίσουμε και πού αλλού μπορεί τελικά να βρίσκονται οι ετήσιες ώρες εργασίας. Έτσι, με πιθανότητα 80% θα βρίσκονται μέσα στη σκούρα μπλε περιοχή και με πιθανότητα 95% θα βρίσκονται μέσα σε όλη τη μπλε περιοχή (σκούρα και αχνή).

Αν το δούμε ανάποδα, μπορούμε να είμαστε 80% σίγουροι ότι οι ετήσιες ώρες εργασίας δεν θα πέφτουν εκτός της σκούρας μπλε περιοχής, και ότι μπορούμε να είμαστε 95% σίγουροι ότι οι ετήσιες ώρες εργασίας δεν θα πέφτουν εκτός της αχνής μπλε περιοχής.

Όλος ο κώδικας που γράψαμε είναι ο κάτωθι:

```{r, eval=F}
ergasiaGr <- workingHours[workingHours$Code == "GRC", 4]
ergasiaGr_ts <- ts(ergasiaGr, start = 1951, frequency =1)
if(!require(forecast)){
	install.packages("forecast")
	library(forecast)
}
ergasiaGr_arima <- auto.arima(ergasiaGr_ts, trace = TRUE)
forecast(ergasiaGr_arima, 5)
autoplot(forecast(ergasiaGr_arima, 5))
```












