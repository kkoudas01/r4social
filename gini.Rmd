---
title: "Μετρώντας την ανισότητα."
author: "Κώστας Κούδας"
cache: TRUE
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
```



```{r, echo=F}
rm(list = ls())
```




# Παρουσίαση δεδομένων  {.tabset .tabset-fade .tabset-pills}

Στην παρούσα ενότητα θα προσπαθήσουμε να αξιολογήσουμε το επίπεδο ανισότητας που υπάρχει σε διάφορες χώρες. Ένας τρόπος είναι να κάνουμε το ακόλουθο νοητικό πείραμα. 

> Το μέσο ετήσιο εισόδημα π.χ. [στην Ελλάδα το 2022 ήταν 13973€](https://www.eea.gr/arthra-eea/koinonia-dyo-tachytiton-oi-misoi-ellines-dilonoyn-eisodimata-kato-ton-10-000-eyro/). Αυτό στο περίπου σημαίνει ότι αν διαλέγαμε τότε έναν Έλληνα στην τύχη, αναμέναμε να τύχουμε κάποιον με εισόδημα $13\ 973$€. 
>
> Ας φανταστούμε τώρα ότι διαλέγαμε δύο Έλληνες.  Τί διαφορά θα αναμέναμε να είχαν τα εισοδήματά τους;
>
> - Αν όλοι οι Έλληνες είχαν ίδιο εισόδημα ($13\ 973$€ έκαστος), θα αναμέναμε μια διαφορά ίση με το $0$.
> - Αν από την άλλη είχαμε μια ακραία ανισότητα όπου όλος ο πλούτος ήταν στα χέρια ενός Έλληνα, τότε η διαφορά που θα συναντούσαμε θα ήταν είτε $0$ (αν τυχαίναμε δύο φτωχούς) είτε $10\ 413\ 982 \cdot 13\ 973=145\ 514\ 570\ 486$€ (αν τυχαίναμε τον πλούσιο με έναν φτωχό). Κατά μέσο όρο, αυτό που περιμένουμε να συντήσουμε αποδεικνύεται ότι ισούται με το διπλάσιο του μέσου εισοδήματος (εν προκειμένω $2 \cdot 13\ 973=27\ 946$€). Σε αυτή την περίπτωση της ακραίας ανισότητας η αναμενόμενη διαφορά θα ήταν η μέγιστη δυνατή.
> - Για τις ενδιάμεσες καταστάσεις ανισότητας θα αναμέναμε να τύχουμε και ενδιάμεσες διαφορές. Κάτι μεταξύ των $0$€ και των $27\ 946$€.
>
> Τί όμως συνέβαινε πραγματικά; Ποια ήταν η αναμενόμενη διαφορά εισοδήματος που θα συναντούσαμε σε δύο τυχαίους Έλληνες; Ή καλύτερα, τι ποσοστό της μέγιστης διαφοράς (εν προκειμένω των $27\ 946$€) θα αναμέναμε να ήταν αυτή η διαφορά; Στην Ελλάδα του 2022 αυτό το ποσοστό ήταν $0.316$, ήτοι $31.6\%$. Με άλλα λόγια, πρόχειρα μιλώντας, στην Ελλάδα του 2022 η τρέχουσα κατάσταση ανισότητας ήταν το $31.6\%$ της μέγιστης δυνατής. Σαν να λέμε, δηλαδή, ότι είχαμε $31.6%$ επίπεδο ανισότητας.
>
> Το ποσοστό αυτό είναι ο λεγόμενος συντελεστής Gini της Ελλάδας για το έτος 2022.


Εν γένει, λοιπόν, ο συντελεστής Gini μιας χώρας είναι το ποσοστό της αναμενόμενης διαφοράς εισοδήματος προς τη μέγιστη δυνατή. Και με πιο πρόχειρα λόγια, είναι το ποσοστό της τρέχουσας κατάστασης ανισότητας σε σχέση με τη μέγιστη δυνατή ανισότητα. Συνεπώς μετράει πόσο μεγάλη ανισότητα υπάρχει στον πληθυσμό.

- Όταν ο συντελεστής Gini παίρνει τιμή 0 (0%), σημαίνει ότι έχουμε μια κατάσταση πλήρους ισότητας.

- Αν παίρνει την τιμή 1 (100%), σημαίνει ότι έχουμε μια κατάσταση ακραίας ανισότητας.

- Αν παίρνει τιμή μεταξύ 0 και 0.3 (0%-30%), τότε υποδεικνύει σχετική ισότητα, ήτοι ο πλούτος κατανέμεται αρκετά ισότιμα.

- Αν είναι μεταξύ 0.3 και 0.4 (30%-40%) υποδηλώνει ότι υπάρχει επαρκής ισότητα. Αυτό σημαίνει ότι το εισόδημα κατανέμεται με ικανοποιητικό τρόπο, αλλά υπάρχει περιθώριο για μεγαλύτερη ισότητα.

- Ένας συντελεστής μεγαλύτερος από 0.4 (40%-100%) δείχνει ότι υπάρχει μεγάλο χάσμα εισοδήματος. Ανισότητα πάνω από αυτό το επίπεδο συχνά συνδέεται με κοινωνική και πολιτική αστάθεια ή ένταση.

- Ακόμα χειρότερα, ένας συντελεστής μεταξύ 0.5 και 1 (50%-100%) σημαίνει ότι υπάρχει σοβαρή ανισότητα μέσα σε μια οικονομία.

Αυτόν θα εξετάσουμε εδώ.

```{r, echo=FALSE, message=FALSE}
if(!require(ggplot2)){
  install.packages("ggplot2")
  library(ggplot2)
}
if(!require(ggridges)){
  install.packages("ggridges")
  library(ggridges)
}
if(!require(rstatix)){
    install.packages("rstatix")
    library(rstatix)
}
if(!require(viridis)){
    install.packages("viridis")
    library(viridis)
}
if(!require(dplyr)){
    install.packages("dplyr")
    library(dplyr)
}
if(!require(reshape)){
    install.packages("reshape")
    library(reshape)
}
if(!require(reshape2)){
    install.packages("reshape2")
    library(reshape2)
}
if(!require(plotly)){
    install.packages("plotly")
    library(plotly)
}
```

Από τη σελίδα του [OECD](https://data-explorer.oecd.org/vis?tm=gini&pg=0&fc=Topic&snb=86&df[ds]=dsDisseminateFinalDMZ&df[id]=DSD_WISE_IDD%40DF_IDD&df[ag]=OECD.WISE.INE&df[vs]=1.0&dq=.A.INC_DISP_GINI.....D_CUR.&pd=%2C&to[TIME_PERIOD]=false&vw=tb) αντλήσαμε τους συντελεστές Gini για διάφορες χώρες και σε διάφορα έτη. Αν προσέξει ο αναγνώστης, θα δει ότι υπάρχουν καταχωρίσεις (`Age`) για την ανισότητα σε μεγάλες ηλικίες (`Over 65 years`), για μικρότερες (`From 18 to 65 years`), αλλά και για την ανισότητα στο σύνολο του πληθυσμού (`Total`).


```{r echo = F, results='asis', message=FALSE}
gini <- read.csv("gini.csv", na.string = "")
exeption <- -which(names(gini) %in% c("STRUCTURE", "STRUCTURE_ID", "STRUCTURE_NAME","ACTION", "FREQ", "Frequency.of.observation", "MEASURE", "Measure", "STATISTICAL_OPERATION", "Statistical.operation", "UNIT_MEASURE", "Unit.of.measure", "DEFINITION", "Definition", "POVERTY_LINE", "Poverty.line", "Time.period","Observation.value", "OBS_STATUS", "Observation.status", "UNIT_MULT", "Unit.multiplier", "CURRENCY", "Currency", "DECIMALS", "Decimals", "PRICE_BASE", "Price.base", "BASE_PER", "Base.period", "CONF_STATUS", "Confidentiality.status"))
gini <- gini[,exeption]
gini <- dcast(gini, REF_AREA+Age+AGE+TIME_PERIOD ~ Methodology, value.var = "OBS_VALUE")
knitr::kable(head(gini)) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "100%", height = "200px")
```

Επειδή ο συντελεστής Gini υπολογίστηκε σε κάποιες περιόδους βάσει παλαιότερων κριτηρίων και σε κάποιες άλλες βάσει των σύγχρονων κριτηρίων (βλ. `Income definition until 2011` και `Income definition since 2012`), θα κρατήσουμε όπου είναι δυνατό τα τρέχοντα κριτήρια υπολογισμού του (`Income definition since 2012`) και, όπου αυτά δεν είναι διαθέσιμα, θα αρκεστούμε στα παλιά (`Income definition until 2011`).


```{r, echo=FALSE}
gini$Gini_coefficient <- ifelse(
  is.na(gini$`Income definition since 2012`),
  gini$`Income definition until 2011`,
  gini$`Income definition since 2012`
)
knitr::kable(head(gini)) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "100%", height = "200px")
```


# Τρέχουσα κατάσταση

# Πορεία στο χρόνο




```{r, echo=FALSE}
giniTotal <- gini[gini$AGE=="_T" ,]
```

```{r, echo=FALSE, message=FALSE}
giniTotalPlot <- ggplot(giniTotal, aes(x=TIME_PERIOD, y=Gini_coefficient, colour = REF_AREA))
#giniTotalPlot + geom_line()+scale_color_viridis_d()

ggplotly(giniTotalPlot + geom_line()+scale_color_viridis_d())
```



```{r, echo=FALSE, message=FALSE}
giniTotalPlot2 <- ggplot(giniTotal, aes(x = Gini_coefficient, y = as.factor(REF_AREA), fill = after_stat(x)))
giniTotalPlot2 +
  geom_density_ridges_gradient(scale = 3, rel_min_height = 0.01, gradient_lwd = 1.) +
  scale_x_continuous(expand = c(0.01, 0)) +
  scale_y_discrete(expand = c(0.01, 0)) +
  scale_fill_viridis(name = "ώρες", option = "C")
```

# Συσχέτιση ανισοτήτων σε μικρές και μεγάλες ηλικίες

```{r, echo=FALSE}
giniGr <- gini[gini$REF_AREA=="GRC",]
```

```{r, echo=FALSE, message=FALSE}
giniGrPlot <- ggplot(giniGr, aes(x=TIME_PERIOD, y=Gini_coefficient, colour = Age))
giniGrPlot + geom_line()
```
```{r, echo=FALSE}
giniWide <- dcast(gini, REF_AREA+TIME_PERIOD~ Age, value.var = "Gini_coefficient")
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
giniAge <- ggplot(giniWide, aes(x=`From 18 to 65 years`, y=`Over 65 years`))
giniAge+geom_point(aes(colour = REF_AREA))+
  geom_smooth()
```

```{r, echo=FALSE}
cor(giniWide$`From 18 to 65 years`, giniWide$`Over 65 years`, use="complete.obs")
```

```{r, echo=FALSE}
lm(giniWide$`From 18 to 65 years` ~ giniWide$`Over 65 years`)
```


