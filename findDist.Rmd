---
title: "Προσδιορισμός κατανομής"
author: "Κώστας Κούδας"
cache: TRUE
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
```

```{r, echo=F}
rm(list = ls())
```

# Εντροπία

Πολλές φορές προκύπτει η ανάγκη, έχοντας τις τυχαίες τιμές μιας μεταβλητής (πχ κάποια ύψη), να δούμε πώς αυτές είναι κατανεμημένες. Αν δεν έχουμε καμιά απολύτως πληροφορία γι’ αυτές, η πιο εύλογη υπόθεση, δηλαδή η υπόθεση με τη μικρότερη μεροληψία, είναι το να δεχτούμε ότι αυτές ακολουθούν την ομοιόμορφη κατανομή (βλ. [εδώ](uniformDiscr.html) κι [εδώ](uniformCont.html)). Αυτό διότι δεν έχουμε λόγο να υποθέσουμε χωρίς περεταίρω στοιχεία ότι έχουμε πχ μια τάξη με ψηλούς μαθητές και λίγους κοντούς ή το αντίστροφο ή μια τάξη που έχει μόνο κοντούς και μόνο ψηλούς μαθητές κτλ. Για να κάνουμε τέτοιες παραδοχές, θα πρέπει να έχουμε κάποιες πληροφορίες παραπάνω που να δικαιολογούν τον έναν ή τον άλλο προσανατολισμό.

Αν τώρα γνωρίζουμε τη μέση τιμή και την τυπική απόκλιση των δειγμάτων, τότε η πιο [εύλογη](https://kconrad.math.uconn.edu/blurbs/analysis/entropypost.pdf) υπόθεση είναι ότι ακολουθούν την [κανονική κατανομή](normalDist.html). Όλα αυτά συνδέονται με την έννοια της εντροπίας που έχουμε δει αλλού (βλ. υποενότητα [Ποικιλότητα Shannon](pikilomorfia.html#1_Ποικιλότητα_Shannon)), αλλά δεν θα εμβαθύνουμε παραπάνω. Στις παρακάτω ενότητες θα δούμε πώς βρίσκουμε την κατανομή που ενδεχομένως ν’ ακολουθούν κάποιες τιμές, αν τις γνωρίζουμε όλες τους, όχι μόνο τη μέση τιμή και την τυπική τους απόκλιση.

# Έλεγχος Kolmogorov-Smirnov για συνεχείς κατανομές

Από τη σελίδα [αυτή](https://ckan.publishing.service.gov.uk/) αντλήσαμε κάποια δεδομένα για τα δέντρα της περιοχής Camden και τα αποθηκεύσαμε σε ένα αρχείο ονόματι Trees_In_Camden.csv, του οποίου παρουσιάζουμε τις 100 πρώτες γραμμές.

```{r echo = F, results='asis', message=FALSE}
Trees_In_Camden <- read.csv("Trees_In_Camden.csv", na.string = "")
knitr::kable(head(Trees_In_Camden, n=100)) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "100%", height = "200px")
```

Θα εξετάσουμε ποια είναι η κατανομή των διαμέτρων των δέντρων στο ύψος του στήθους ενός ανθρώπου. Για λόγους ευκολίας, λοιπόν, ορίζουμε αρχικά:

```{r}
diametros <- Trees_In_Camden$Diameter.In.Centimetres.At.Breast.Height
```

Η διάμετρος ενός δέντρου είναι συνεχής μεταβλητή, με την έννοια ότι μπορεί να πάρει όλες τις πιθανές τιμές σε ένα διάστημα. Μπορεί, δηλαδή, να γίνει 13cm, 14cm, αλλά και 13.5cm ή και 13.78cm. Για να δούμε, λοιπόν, ποια κατανομή ακολουθεί, θα χρησιμοποιήσουμε τον έλεγχο Kolmogorov-Smirnov.

Υπάρχουν πολλές συνεχείς κατανομές, εμείς θα αρκεστούμε σε δύο βασικές: την ομοιόμορφη και την εκθετική. Σημαντική είναι και η κανονική, αλλά με αυτήν θα ασχοληθούμε ειδικότερα σε άλλη ενότητα. Ο ενδιαφερόμενος αναγνώστης μπορεί να κάνει την δικιά του έρευνα, αν δεν τον καλύπτει αυτή η μικρή λίστα. Σε κάθε περίπτωση η μηδενική υπόθεση θα είναι ότι το δείγμα μας έχει αντληθεί από την τάδε κατανομή. Έτσι, αν η $\boldsymbol{\mathcal{H}_0}$ απορρίπτεται, πάει να πει πως το δείγμα μας δεν ακολουθούσε αυτή την κατανομή. Αντίθετα, αν η $\boldsymbol{\mathcal{H}_0}$ δεν καταφέρουμε να απορριφθεί, τότε δεν έχουμε επαρκή στοιχεία να διαπιστώσουμε ότι δεν ακολουθεί το δείγμα αυτή την κατανομή, άρα αναγκαστικά δεχόμαστε ότι την ακολουθεί.

Επειδή θα έχουμε πρόβλημα με τις μη διαθέσιμες τιμές (`NA`), τις εξαλείφουμε, γράφοντας:

```{r}
diametrosNA <- diametros[!is.na(diametros)]
```

Αρχικά θα ελέγξουμε αν οι διάμετροι ακολουθούν την ομοιόμορφη κατανομή με το ίδιο εύρος με αυτό του δείγματος. Έτσι γράφουμε:

```{r}
ks.test(diametrosNA, "punif", min = min(diametrosNA), max = max(diametrosNA))
```

Βρίσκουμε έτσι ότι η p-τιμή είναι μικροσκοπική, άρα η μηδενική υπόθεση θα πρέπει να απορριφθεί ως απίθανη. Συνεπώς, δεν ακολουθεί την ομοιόμορφη κατανομή. Το μήνυμα προειδοποίησης έχει να κάνει με το γεγονός ότι υπάρχουν πολλές ίσες διάμετροι, πράγμα ανεπιθύμητο στον έλεγχο Kolmogorov-Smirnov. Για αρχή θα αγνοήσουμε αυτό το σφάλμα.

Εύλογα θα πει κανείς «Είναι δυνατόν να πάρουμε σβάρνα όλες τις κατανομές, μέχρι να πετύχουμε τη σωστή;». Δεν θα είχε άδικο. Προς τούτο θα κάνουμε το ιστόγραμμα των διαμέτρων, μήπως μας προσανατολίσει.

```{r}
hist(diametrosNA)
```

Το ιστόγραμμα μοιάζει πολύ με αυτό των [εκθετικών κατανομών](expDist.html). Οπότε θα κάνουμε και τον σχετικό έλεγχο.

Αν ακολουθούν την εκθετική κατανομή, αυτή θα έχει παράμετρο τον αντίστροφο της μέσης τιμής του δείγματος. Οπότε γράφουμε:

```{r}
ks.test(diametrosNA, "pexp", rate = 1/mean(diametrosNA))
```

Εξακολουθεί, φυσικά, να προκύπτει το ίδιο μήνυμα προειδοποίησης. Το αναπάντεχο είναι ότι τελικά το δείγμα δεν ακολουθεί ούτε την εκθετική κατανομή, αφού κι εδώ η p-τιμή είναι μικρότερη του 0.05. Κι αυτό είναι ένα μάθημα που θα πρέπει να πάρουμε ως προς το πόσο μπορούμε να εμπιστευόμαστε μόνο ένα στατιστικό εργαλείο, πχ τα ιστογράμματα.

Συνολικά γράψαμε τον κώδικα:

```{r, eval=F}
diametros <- Trees_In_Camden$`Diameter In Centimetres At Breast Height`
diametrosNA <- diametros[!is.na(diametros)]
ks.test(diametrosNA, "punif", min = min(diametrosNA), max = max(diametrosNA))
hist(diametrosNA)
ks.test(diametrosNA, "pexp", rate = 1/mean(diametrosNA))
```

# Έλεγχος χ2 για διακριτές κατανομές

```{r, echo=F}
rm(list = ls())
```

Εδώ θ’ ασχοληθούμε με τις θέσεις στάθμευσης στο Camden του Λονδίνου. Προφανώς, πρόκειται για διακριτή κατανομή, αφού μπορούμε να έχουμε μόνο ακέραιο αριθμό θέσεων πάρκινγκ. Δεν μπορούμε να έχουμε πχ 2.5 ή 1.97 θέσεις πάρκινγκ. Έτσι, δεν θα χρησιμοποιήσουμε τον έλεγχο Kolmogorov-Smirnov, αλλά τον έλεγχο χ2. Και πάλι, βέβαια, η μηδενική υπόθεση θα είναι ότι ακολουθείται η εκάστοτε κατανομή.

Αντλήσαμε στοιχεία πάλι από [εδώ](https://ckan.publishing.service.gov.uk/) και τ’ αποθηκεύσαμε σε ένα αρχείο ονόματι Parking_Bays.csv.

```{r echo = F, results='asis', message=FALSE}
Parking_Bays <- read.csv("Parking_Bays.csv", na.string = "")
knitr::kable(head(Parking_Bays, n=100)) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "100%", height = "400px")
```

Ακολούθως κρατήσαμε τη λίστα με τις εκάστοτε διαθέσιμες θέσεις κι εξαφανίσαμε τις μη διαθέσιμες τιμές (`NA`) γράφοντας:

```{r}
thesis <- Parking_Bays$Parking.Spaces
thesisNA <- thesis[!is.na(thesis)]
```

Ακολούθως σχηματίζουμε τον πίνακα συχνοτήτων των τιμών της λίστας thesisNA, δηλαδή τον πίνακα που δίνει τη συχνότητα εμφάνισης για το κάθε πλήθος θέσεων πάρκινγκ:

```{r}
pinakas <- table(thesisNA)
```

```{r echo = F, results='asis', message=FALSE}
knitr::kable(pinakas) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "max-content", height = "200px")
```

Έχουμε λοιπόν ότι 1 θέση πάρκινγκ έχουν 2805 περιοχές, 2 θέσεις πάρκινγκ έχουν 1400 περιοχές, 3 θέσεις πάρκινγκ έχουν 940 περιοχές κ.ο.κ.

Ακολούθως, κρατάμε τα πλήθη των θέσεων πάρκινγκ που εμφανίζονται γράφοντας:

```{r}
times_d <- as.integer(names(pinakas))
```

Και τώρα είμαστε έτοιμοι να εκτελέσουμε τα τεστ μας.

Όσον αφορά την [ομοιόμορφη κατανομή](uniformDiscr.html) θα πρέπει αρχικά να δούμε πόσες πιθανές περιπτώσεις για θέσεις πάρκινγκ υπάρχουν. Οπότε γράφουμε:

```{r}
periptosis <- length(times_d)
```

Στόχος μας τώρα είναι να φτιάξουμε μια λίστα με τις πιθανότητες που αντιστοιχούν στην κάθε περίπτωση. Πχ είναι 30% πιθανό να τύχουμε 1 θέση πάρκινγκ, 27% να τύχουμε 2 θέσεις πάρκινγκ κ.τ.λ. Εμείς όμως θέλουμε να φτιάξουμε τη λίστα με τις πιθανότητες που θα είχαν οι θέσεις πάρκινγκ, αν ακολουθούσαν την ομοιόμορφη κατανομή. Έτσι, αφού στην ομοιόμορφη κατανομή κάθε περίπτωση έχει ίδια πιθανότητα με τις άλλες, θα φτιάξουμε μια λίστα που θα επαναλαμβάνεται η ίδια ακριβώς πιθανότητα:

```{r}
pithOm <- rep(1/periptosis, periptosis)
```

Δηλαδή εμείς εδώ έχουμε 48 περιπτώσεις, άρα θέλαμε μια λίστα 48 στοιχείων (ένα για κάθε περίπτωση) όπου το κάθε στοιχείο θα είναι το $\frac{1}{48}$, ώστε συνολικά να έχουμε πιθανότητα 1, δηλαδή 100%.

Έτσι, το τεστ χ2 εκτελείται χρησιμοποιώντας και πάλι τη συνάρτηση `chisq.test(💻💻💻,📸📸📸)`, όπου:

-   στη θέση του 💻💻💻 θα βάλουμε τον πίνακα συχνοτήτων μας και

-   στη θέση του 📸📸📸 θα βάλουμε τη λίστα με τις πιθανότητες.

Έτσι, γράφοουμε απλά:

```{r}
chisq.test(pinakas, p = pithOm)
```

Οπότε βρίσκουμε ότι η p-τιμή είναι απειροελάχιστη, άρα και σίγουρα μικρότερη του 0.05. Επομένως η μηδενική υπόθεση είναι αρκετά απίθανη, άρα απορρίπτεται, όπερ σημαίνει ότι το δείγμα μας δεν ακολουθεί την ομοιόμορφη κατανομή.

Ομοίως απορρίπτεται και η υπόθεση ότι το δείγμα μας ακολουθεί την διωνυμική κατανομή $\mathcal{B}(10,\frac{1}{10})$ ή την $\mathcal{B}(35,\frac{3}{22})$. Αυτό το βλέπουμε, αν και δεν θα παρουσιάσουμε την εικόνα του αποτελέσματος, εκτελώντας τις εντολές:

```{r}
pithDion1 <- dbinom(times_d, size=10, prob=1/10)
chisq.test(pinakas, p = pithDion1, rescale.p = TRUE)
pithDion2 <- dbinom(times_d, size=35, prob=3/22)
chisq.test(pinakas, p = pithDion2, rescale.p = TRUE)
```

Η εντολή `rescale.p = TRUE` πήγε ώστε οι τιμές των πιθανοτήτων να επαναπροσαρμοστούν, ώστε να βγάζουν άθροισμα 1. Το ότι δεν έβγαζαν άθροισμα 1 οφείλεται σε σφάλματα στρογγυλοποίησης που προέκυψαν τώρα, και γι’ αυτό δεν το χρειαστήκαμε στην περίπτωση της ομοιόμορφης κατανομής προηγουμένως.

Μπορούμε να διαπιστώσουμε ότι απορρίπτεται και μια συγκεκριμένη [υπεργεωμετρική κατανομή](hyperGeom.html) (αυτή της ενότητας που παρουσιάστηκε) γράφοντας:

```{r}
pithYpGeom <- dhyper(times_d, 12, 40, 5)
chisq.test(pinakas, p = pithYpGeom, rescale.p = TRUE)
```

Στο σημείο αυτό θα μπορούσε κάποιος, δικαίως, ν’ αρχίσει να κουράζεται. Θα ήταν καλή ιδέα τοιαύτη περιπτώσει, αντί να ελέγχουμε στα τυφλά τις διάφορες κατανομές, να κάνουμε ένα ιστόγραμμα για να μας προσανατολίσει:

```{r}
hist(thesisNA)
```

Παρατηρούμε ότι το ιστόγραμμα μοιάζει πολύ με αυτό της [γεωμετρικής κατανομής](geom.html). Οπότε θα είναι και αυτή που θα δοκιμάσουμε.

Η πιο κοντινή περίπτωση για τη γεωμετρική κατανομή είναι αυτή που έχει πιθανότητα τον αντίστροφο της μέσης τιμής του δείγματός μας. Έτσι γράφουμε:

```{r}
pithGeom <- dgeom(times_d, p = 1/mean(thesisNA))
chisq.test(pinakas, p = pithGeom, rescale.p = TRUE)
```

όπου έχουμε τη δυσάρεστη έκπληξη να απορρίπτεται και αυτή η κατανομή. Τα φαινόμενα απατούν τελικά.

Αν μία φορά ήταν απίθανο ν’ ακολουθεί την γεωμετρική κατανομή τότε είναι 1000 φορές απίθανο ν’ ακολουθεί την [αρνητική διωνυμική](nBinom.html) και την [Poisson](poisson.html). Ήδη τα ιστογράμματα μάς λένε «Ούτε να το σκέφτεσαι». Παραταύτα, για λόγους πληρότητας των καταγεγραμένων περιπτώσεων θα κάνουμε δύο ακόμα ελέγχους κι ας είναι αναμενόμενη η απόρριψη των κατανομών αυτών.

```{r}
pithArnDion <- dnbinom(times_d, size = 8, prob = 2/3)
chisq.test(pinakas, p = pithArnDion, rescale.p = TRUE)
pithPois <- dpois(times_d, mean(thesisNA))
chisq.test(pinakas, p = pithPois, rescale.p = TRUE)
```

Συνολικά ασχοληθήκαμε με αυτόν τον κώδικα:

```{r, eval=F}
thesis <- Parking_Bays$`Parking Spaces`
thesisNA <- thesis[!is.na(thesis)]
pinakas <- table(thesisNA)
times_d <- as.integer(names(pinakas))
periptosis <- length(times_d)
pithOm <- rep(1/periptosis, periptosis)
chisq.test(pinakas, p = pithOm)
pithDion1 <- dbinom(times_d, size=10, prob=1/10)
chisq.test(pinakas, p = pithDion1, rescale.p = TRUE)
pithDion2 <- dbinom(times_d, size=35, prob=3/22)
chisq.test(pinakas, p = pithDion2, rescale.p = TRUE)
pithYpGeom <- dhyper(times_d, 12, 40, 5)
chisq.test(pinakas, p = pithYpGeom, rescale.p = TRUE)
hist(thesisNA)
pithGeom <- dgeom(times_d, p = 1/mean(thesisNA))
chisq.test(pinakas, p = pithGeom, rescale.p = TRUE)
pithArnDion <- dnbinom(times_d, size = 8, prob = 2/3)
chisq.test(pinakas, p = pithArnDion, rescale.p = TRUE)
pithPois <- dpois(times_d, mean(thesisNA))
chisq.test(pinakas, p = pithPois, rescale.p = TRUE)
```

