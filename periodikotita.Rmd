---
title: "Μελέτη εποχικότητας"
author: "Κώστας Κούδας"
cache: TRUE
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
```

```{r, echo=F}
rm(list = ls())
```

# Εντοπισμός εποχικότητας

Σε [προηγούμενη ενότητα](motiba.html) αναφέρθηκε η έννοια της εποχικότητας. Εδώ θα εμβαθύνουμε λίγο παραπάνω. 

Από το [Google Trends](https://trends.google.com/trends/) κατεβάσαμε το αρχείο massExt.csv, το οποίο περιέχει το πλήθος των «γκουγκλαρισμάτων» της φράσης «mass extinction» στις ΗΠΑ από 1/1/2004 έως και σήμερα 14/4/2024. Για την ακρίβεια, στο εν λόγω αρχείο δεν παρουσιάζεται ακριβώς το πλήθος, αλλά έχει αυτό κανονικοποηθεί ως προς τη μέγιστη τιμή του. Δηλαδή, αυτή ετέθη 100 και οτιδήποτε άλλο πάει συγκριτικά με αυτήν.

```{r echo = F, results='asis', message=FALSE}
massExtDF <- read.csv("massExt.csv")
knitr::kable(massExtDF) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "max-content", height = "200px")
```

Επίσης από το [Statista](https://www.statista.com/) κατεβάσαμε δεδομένα που αφορούν τους γάμους που έγιναν στην Ελλάδα από το 1980 έως και το 2022. Τα δεδομένα καταχωρήθηκαν στο αρχείο gamoi.xlsx, όπου η μία στήλη δίνει το έτος, η άλλη το πλήθος γάμων ανά 1000 άτομα και η τελευταία το πλήθος των γάμων γενικώς.

```{r echo = F, results='asis', message=FALSE}
if(!require(readxl)){
    install.packages("readxl")
    library(readxl)
}
gamoi <- readxl::read_excel("gamoi.xlsx")
knitr::kable(gamoi) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "max-content", height = "200px")
```


Κατόπιν εξάγουμε τις λίστες με τα δεδομένα που μας απασχολούν: *τα γκουγκλαρίσματα και τους γάμους*.

```{r}
massExt <- massExtDF$mass.extinction...United.States.
gamoiSynolo <- gamoi$GamoiSynolo
```

Παράλληλα με τα παραπάνω θα ασχοληθούμε και με μια κευασμένη από εμάς χρονοσειρά, την `y`:

```{r}
x <- 1:100
y <- x+6*sin( (2*pi/3) * x)-4*cos( (2*pi/6) * x)+rnorm(100)
```

Αυτή φτιάχτηκε να έχει ανωδική τάση (`y <- x+...`) και εποχικότητα 6 μονάδων (`4*cos( (2*pi/6) * x)`), ελαφρώς αλλειωμένες από έναν θόρυβο (`rnorm(100)`). Παράλληλα εντός της εμφανίζεται και μια κινητικότητα ανά 3 χρονικές μονάδες (`6*sin( (2*pi/3) * x)`).

## Χρονόγραμμα

Κάνουμε μια πρώτη απόπειρα αναπαράστασής τους. Δεν θα παραστήσουμε καν την ένδειξη του χρόνου, για να είμαστε τελείως απερίσπαστοι και να μην προκαταβάλουμε κάποια συμπεράσματα.

```{r}
plot(massExt, type ="l")
```

Παρατηρούμε μια κυκλική συμπεριφορά των γκουγκλαρισμάτων, δηλαδή ανά τακτά διαστήματα έχουμε κάποιες παρόμοιες αυξομοιώσεις. Ας δούμε τώρα και τους γάμους.


```{r}
plot(gamoiSynolo, type ="l")
```

Αν εξαιρέσουμε την εμφανή πτωτική τάση προς το τέλος, εν γένει κι αυτοί εμφανίζουν μια εποχικότητα.

Τέλος, η δικιά μας η χρονοσειρά `y` έχει εμφανέστατη εποχικότητα, όπως φαίνεται παρακάτω:

```{r}
plot(y, type ="l")
```

## Διάγραμμα υστέρησης

Συνεχίζουμε με τα διαγράμματα υστέρησης, για να επιβεβαιώσουμε όσα υποψιαστήκαμε πριν.

```{r, message=F}
if(!require(forecast)){
    install.packages("forecast")
    library(forecast)
}
```

```{r}
gglagplot(massExt, continuous = TRUE, set.lags = 2*(1:10))
```

Παρατηρούμε ότι το lag = 12 κείτεται επί της ευθείας $y=x$, όπερ δείχνει ισχυρή συσχέτηση ανά 12 μονάδες του χρόνου, ήτοι μια εποχική επανάληψη ανά 12 χρονικές μονάδες.

Ας δούμε τι παίζει και με τους γάμους.

```{r}
gglagplot(gamoiSynolo, continuous = TRUE, set.lags = 2*(1:10))
```

Εδώ φαίνεται να υπάρχει εποχικότητα ανά 4 χρονικές μονάδες, αλλά όχι τόσο εμφανής, όσο προηγουμένως. Παρατηρούμε επίσης και μια μετατώπιση του γραφήματος σιγά-σιγά κάτω από την $y=x$, πράγμα που υποδηλώνει πτωτική τάση των γάμων. Άραγε, η κυκλική συμπεριφορά των γάμων ανά 4 έτη να αντικατοπτρίζει την προκατάλειψη του πληθυσμού για τα δίσεκτα έτη, ως προς το ότι αυτά είναι «γρουσούζικα» για το γάμο;

Όσον αφορά την φτιαχτή από μας χρονοσειρά `y` τα πράγματα είναι ακόμα πιο καθαρά. Αν στις δύο προηγούμενες περιπτώσεις πασχίζαμε να εκλάβουμε ως ευθεία το γράφημα σε κάποιο lag, τώρα η ευθεία φαίνεται ολοκάθαρα μπροστά μας στο lag = 6. Δηλαδή, είναι προφανής η εποχική επανάληψη ανά 6 χρονικές μονάδες.

```{r}
gglagplot(y, continuous = TRUE, set.lags = 2*(1:10))
```

##    ∆ιάγραµµα αυτοσυσχέτισης

Τέλος θα σχεδιάσουμε το διάγραµµα αυτοσυσχέτισης από την κάθε περίπτωση. Αρχικά ερευνούμε τα γκουγκλαρίσματα.

```{r}
acf(massExt)
```

Και πάλι παρατηρούμε ισχυρή αυτοσυσχέτιση ανά 12 χρονικές μονάδες.

Ας δοκιμάσουμε την ισχύ της διαίσθησής μας και στην περίπτωση των γάμων.

```{r}
acf(gamoiSynolo)
```

Ανά 4 μονάδες του χρόνου παρατιρείται ισχυρή συσχέτιση, άρα επανάληψη, η οποία όμως εξασθενεί στην πορεία του χρόνου, πιθανότατα λόγω της προαναφερθείσας πτωτικής τάσης.

Τέλος ας δούμε τι γίνεται και με την `y`.

```{r}
acf(y)
```

Διακρύνουμε σίγουρα μια πτωτική τάση στην συσχέτιση της χρονοσειράς με τον... εαυτό της, πράγμα που αντανακλά την έντονη αυξητική τάση της. Η εποχικότητα εμφανίζεται ως στιγμιαίες ανυψώσεις ανά 6 lag.

# Κάταχώρηση χρονοσειράς βάσει διαπιστώσεων εποχικότητας


Στο σημείο αυτό είμαστε σε θέση να εισάγουμε τον χρόνο στις χρονοσειρές μας. Θα ακολουθήσουμε τη [γνωστή πορεία](timeBasic.html#2_Καταχώρηση_χρονοσειράς), με μία διαφορά στην τιμή της παραμέτρου `freq`. Στην ενότητα [Καταχώρηση χρονοσειράς](timeBasic.html#2_Καταχώρηση_χρονοσειράς) αναφέραμε ότι η `freq` είναι κατά το μάλλον ή ήττον για να περιγράφουμε το χρόνο που εξελίσσεται η χρονοσειρά μας. Στην πραγματικότητα η `freq` περιγράφει τον χρόνο ενός κύκλου επανάληψης. Έτσι, αφού είδαμε ότι τα κουγκλαρίσματα επαναλαμβάνονται ανά 12 μήνες, θα γράψουμε:

```{r}
massExtts <- ts(massExtDF$mass.extinction...United.States., start = c(2004, 1), freq=12)
```

Και αφού οι γάμοι παρουσιάζουν μια εποχική συμπεριφορά ανά 4 χρόνια, θα γράψουμε:

```{r}
gamoiSynolots <- ts(gamoi$GamoiSynolo, start = 0, freq=4)
```

Τέλος, είναι εύλογο ότι η «χειροποίητη» χρονοσειρά `y` θα καταχωρηθεί ως έχουσα `freq=6`.

```{r}
yTs <- ts(y, start = 0, frequency = 6)
```



# Στατιστικός έλεγχος εποχικότητας. 

Είδαμε παραπάνω δύο γραφικούς τρόπους εντοπισμού της εποχικότητας. Τώρα θα δούμε έναν στατιστικό έλεγχο που θα μας επιβεβαιώνει τα όσα είδαμε με τα μάτια μας. Προς τούτο θα χρειαστούμε το πακέτο `seastests`, οπότε γράφουμε:

```{r, message=F}
if(!require(seastests)){
    install.packages("seastests")
    library(seastests)
}
```

Έτσι, δεν έχουμε παρά να χρησιμοποιήσουμε τη συνάρτηση `isSeasonal()`, στην οποία θα εκχωρίσουμε ως όρισμα τη χρονοσειρά μας. Έτσι, αρχίζοντας με τα γκουγκλαρίσματα, θα γράψυμε:

```{r}
isSeasonal(massExt, freq=12)
```

ώστε να δούμε αν υφίσταται  12-μηνη εποχικότητα (`freq=12`). Και τελικά όντως υφισταται, αφού εξήχθη απάντηση `TRUE`. Εναλλακτικά από την παραπάνω γραφή, θα μπορούσαμε να γράψουμε:

```{r}
isSeasonal(massExtts)
```

καθόσον μέσα στη χρονοσειρά `massExtts` ενυπάρχει και η πληροφορία για 12-μηνη συχνότητα.

Πάμε τώρα στους γάμους. Γράφουμε τα δύο παρακάτω ισοδύναμα πράγματα:


```{r}
isSeasonal(gamoiSynolo, freq=4)
isSeasonal(gamoiSynolots)
```

Και πάλι μας εξάγεται η απάντηση `TRUE`, άρα όντως και οι γάμοι έχουν τετραετή εποχικότητα.

Τέλος, ας δούμε και την «προκάτ» χρονοσειρά `y`:

```{r}
isSeasonal(y, freq=6)
isSeasonal(yTs)
```

Για άλλη μια φορά επιβεβαιώνεται η εποχική συμπεριφορά ανά 6 μονάδες του χρόνου.

Πριν πάμε στην επόμενη ενότητα αξίζει ν' αναφέρουμε ότι ο παραπάνω στατιστικός έλεγχος δεν ανιχνεύει την ύπαρξη γενικώς κάποιας εποχικότητας, αλλά ελέγχει αν υφίσταται η συγκεκριμένη εποχικότητα. Έτσι, αν επί παραδείγματι γράψουμε:

```{r}
isSeasonal(y, freq=7)
```

η απάντηση είναι `FALSE`, δηλαδή ότι δεν υπάρχει καμία εποχική συμπεριφορά ανά 7 μονάδες του χρόνου.




# Άντληση περιοδικής συνιστώσας χρονοσειράς

Στο σημείο αυτό έχουμε την δυνατότητα να πράξουμε κάτι πραγματικά σπουδαίο! Έχουμε τη δυνατότητα να αναλύσουμε τη χρονοσειρά μας στα εξ ων συνετέθη. Θα την διασπάσουμε σε τρεις χρονοσειρές:

- μία συνιστώσα που να δείχνει καθαρά την τάση της,
- μία περιοδική συνιστώσα που να αντικατοπτρίζει αποκλειστικά την εποχική συμπεριφορά της,
- μία συνιστώσα θορύβου.

Αυτό θα γίνει με τη βοήθεια της συνάρτησης `stl()` ως ακολούθως.



```{r}
massExttsComp <- stl(massExtts, s.window = "periodic")
plot(massExttsComp)
```

Σε αυτή την εικόνα:

- αρχικά παρουσιάζεται η αυθεντική χρονοσειρά μας (`data`),
- ακολούθως η περιοδική συνιστώσα (`seasonal`),
- μετά η συνιστώσα τάσης (`trend`) και
- τέλος ο θόρυβος.

Αξίζει να παρατηρήσουμε την αύξουσα τάση των γκουγκλαρισμάτων. Να αντικατοπτρίζει άραγε αυτή μια απαισιόδοξη τάση της κοιωνίας;

Τώρα, αν θέλουμε να έχουμε πρόσβαση σε κάθε μία από τις συνιστώσες μπορούμε να χρησιμοποιήσουμε τις συναρτήσεις:

- `seasonal` για την εποχική συνιστώσα:

```{r}
SeasonalMassExt <- seasonal(massExttsComp)
plot(SeasonalMassExt)
```


- `trendcycle` για τη συνιστώσα τάσης:

```{r}
TrendMassExt <- trendcycle(massExttsComp)
plot(TrendMassExt)
```

- `remainder` για τη συνιστώσα θορύβου:

```{r}
RemainderMassExt <- remainder(massExttsComp)
plot(RemainderMassExt)
```

Αυτά, όσον αφορά τα γκουγκλαρίσματα. Πάμε τώρα να δούμε τυς γάμους:

```{r}
gamoiSynolotsComp <- stl(gamoiSynolots, s.window = "periodic")
plot(gamoiSynolotsComp)
```

Η συνιστώσα τάσης δείχνει ολοκάθαρα πλέον μια καθαρή πτωτική συμπεριφορά των γάμων.

Τέλος, ας δούμε πως αποσυντίθεται και η χρονοσειρά που φτιάξαμε.


```{r}
yTsComp <- stl(yTs, s.window = "periodic")
plot(yTsComp)
```





# Ανάλυση περιοδικής χρονοσειράς

## Περιοδόγραμμα Lomb-Scargle {.tabset .tabset-fade .tabset-pills}

Πριν μπούμε στο ψητό αυτής της ενότητας, θα πρέπει να δούμε κάποια πράγματα. Ας φανταστούμε, λοιπόν, ένα μέγεθος (π.χ. έναν πληθυσμό) το οποίο εξελίσσεται στην πάροδο του χρόνου. Ας υποθέσουμε επίσης ότι υπάρχει μια τιμή του (η **θέση ισορροπίας**), από την οποία όσο απομακρύνεται, τόσο πιο ισχυρά μια αόρατη δύναμη το «σπρώχνει» να επιστρέψει πίσω. Όταν συμβαίνει αυτό, το μέγεθος αυτό αυξομοιώνεται πάνω-κάτω από τη θέση ισορροπίας του:

- Απομακρύνεται αρχικά από τη θέση ισορροπίας, άρα του ασκείται δύναμη επαναφοράς.

- Η δύναμη επαναφοράς το σπρώχνει πίσω στη θέση ισορροπίας.

- Λόγω κεκτημένης ταχύτητας προσπερνά τη θέση ισορροπίας και απομακρύνεται από αυτήν.

- Αφού έχει απόσταση από τη θέση ισορροπίας, η δύναμη επαναφοράς το σπρώχνει πίσω.

κ.ο.κ.

Όλη αυτή η διαδικασία είναι περιοδική, δηλαδή επαναλαμβάνεται ανά τακτά διαστήματα.

Ας φανταστούμε τώρα ότι καθόλη τη διάρκεια της κίνησής του αυτό μπορεί να εκτραπεί από την προβλεπόμενη θέση του κι ας υποθέσουμε πάλι ότι υπάρχει και μια άλλη αόρατη δύναμη, που προσπαθεί να το επαναφέρει στην προβλεπόμενη θέση. Κι αυτή τη φορά η δύναμη μεγαλώνει, όσο πιο μακριά είναι το μέγεθος από την προβλεπόμενη θέση. Και στην προκειμένη περίπτωση η διαδικασία είναι περιοδική, δηλαδή επαναλαμβάνεται ανά τακτά διαστήματα. Σε αυτή τη διαδικασία θα λέγαμε ότι υπάρχουν δύο κύκλοι επανάληψης:

- ο αρχικός κύκλος πέριξ της θέσης ισορροπίας,

- ο νέος κύκλος γύρω από την προβλεπόμενη θέση που θα έπρεπε να είναι, αν υφίστατο μόνο ο πρώτος κύκλος.

Ο εμπλουτισμός με τέτοιες ταλαντώσεις μπορεί να συνεχιστεί αυθαίρετα. Κι εδώ ανακύπτουν κάποια ερωτήματα. «Πώς μπορώ να βρω πόσο μεγάλοι είναι αυτοί οι κύκλοι;». «Ποιο πήγαινε-έλα έχει το πιο έντονα χαρακτηριστικά;»

Αυτά τα ερωτήματα έρχεται ν' απαντήσει το **περιοδόγραμμα Lomb-Scargle**.


### Γράφημα

Το περιοδόγραμμα Lomb-Scargle δείχνει πόσο ισχυρές είναι οι δυνάμεις του εκάστοτε κύκλου επαναφοράς. Συγκεκριμένα, αν και αυτό ίσως να μην απασχολεί τον μέσο αναγνώστη, δίνει το βαθμό ταύτισης της χρονοσειράς μας με μια λίστα ημιτονοειδών χρονοσειρών διαφόρων συχνοτήτων. Οι συγκρίσεις γίνονται μέσω του τεστ $\chi^2$ (βλ. [Έλεγχος χ2 για διακριτές κατανομές](findDist.html#3_Έλεγχος_χ2_για_διακριτές_κατανομές)).

Τέλος πάντων, ας το δούμε και πρακτικά. Για να το φτιάξουμε θα χρειαστούμε το πακέτο `lomb`:

```{r, message=F}
if(!require(lomb)){
    install.packages("lomb")
    library(lomb)
}
```

Οπότε πάμε να δούμε τι συμβαίνει μα τα γκουγκλαρίσματα των μαζικών καταστροφών:

```{r}
lsp(massExt)
```

Η προκαθορισμένη εκδοχή του περιοδογράμματος Lomb-Scargle εξάγει τη συχνότητα του φαινομένου. Εν προκειμένω η κυρίαρχη συχνότητα είναι περίπου 0.08 γκουγκλαρίσματα ανά χρονική μονάδα. Δηλαδή το τεστ $\chi^2$ υποδηλώνει ουκ ευκαταφρόνητη στατιστική εξαρτηση με ημιτονοειδή σερά συχνότητας περίπου 0.08. Επί τη ευκαιρία, η μπλε διακεκκομμένη γραμμή δίνει το επίεδο σημαντικότητας. Οι κορυφές των αντίστοιχων συχνοτήτων κάτω από αυτήν θεωρούνται αρκετά απίθανο να συνδέονται με κάποια αντίστοιχη ημιτονοειδή χρονοσειρά. 

Κάποιος θα παρατηρούσε ότι υπάρχει και μια άλλη κορύφωση, κοντά στο 0. Γιατί την αγνωούμε; Στην πραγματικότητα αυτή η κορύφωση είναι ένα σφάλμα που πρέπει να αγνωήσουμε και που οφείλεται στο ότι η χρονοσειρά μας δεν ήταν εντελώς περιοδική, αλλά περιείχε τάσεις. Αν αυτές απαλοιφθούν, δηλαδή αν χρησιμοποιήσουμε τη `SeasonalMassExt`, τότε θα δούμε ότι δεν υπάρχει πλέον τέτοια ένδειξη.

```{r}
lsp(SeasonalMassExt)
```

Όμως, σε τι χρονικές μονάδες αυτό αντικατοπτρίζεται η συχνότητα 0.08; Σε $\frac{1}{0.08}\approx 12$, όπως είχαμε βρει κι εμείς από τις άλλες περιπτώσεις. Αλλά ας το δούμε και πιο «ετοιματζίδικα» χρησιμοποιώντας την παράμετρο `type`.

```{r}
lsp(massExt, type = "period")
```



Εμφανίζεται η περίοδος πλέον. Το κομμάτι που φαίνεται να «απογειώνεται» στο τέλος δεν υποδεικνύει κάποια άλλη περίοδο, αλλά είναι αποτέλεσμα του ότι η χρονοσειρά μας δεν είναι εντελώς περιοδική. Είναι ακριβώς το ίδιο παραπλανητικό σφάλμα που συναντήσαμε και στην περίπτωση της συχνότητας. Αν εξαφανίσουμε πάλι κάθε τάση της και κρατήσουμε μόνο την περιοδικότητα, θα πάψει να εμφανίζεται αυτή η παραδοξότητα.


```{r}
lsp(SeasonalMassExt,type = "period")
```

αλλά όχι πολύ καθαρά. Δεν είναι καθόλου προφανές ποια είναι αυτή. Φαίνεται να είναι κάπου ανάμεσα στο 5 και στο 25, αλλά δεν είναι ευδιάκριτο. Θα περιορίσουμε, λοιπόν, το περιοδόγραμμα εκεί προσδιορίζοντας ανάλογα τις παραμέτρους `from` και `to`:

```{r}
lsp(massExt, from = 5, to = 25, type = "period")
```

Πλέον είναι φανερή η περιοδική συμπεριφορά ανά 12 περίπου χρονικές μονάδες. Επαναλαμβάνουμε ότι αυτό σημαίνει ότι μάλλον η χρονοσειρά μας διακατέχεται από μιαν επαναληπτικότητα της τάξης των 12 χρονικών μονάδων.

Ας δούμε τώρα κάποιες παραμέτρους ακόμα. Η μπλε διακεκκομένη γραμμή δίνει, όπως είπαμε, το επίπεδο σημαντικότητας. Η προκαθορισμένη τιμή είναι το 0.01, ήτοι ίσως αρκετά μικρή για έναν κοινωνικό επιστήμονα. Μπορούμε να δοκιμάσουμε κάποια μεγαλύτερη, όπως την 0.05 πειράζοντας την παράμετρο `alpha` ως ακολούθως.

```{r}
lsp(massExt, from = 5, to = 25, type = "period", alpha = 0.05)
```

Βλέπουμε πλέον ότι ίσως να μην είναι απίθανη η σύνδεση της χρονοσειράς μας με μια ημιτονοειδή χρονοσειρά περιόδου περίπου 6 χρονικών μονάδων. Τι σημαίνει αυτό; Σημαίνει ότι υπάρχουν κάποιες έντονες τάσεις κύμανσης που κάνουν τα φαινόμενα να επα

Ο αναγνώστης ίσως να έχει παρατηρήσει την έντονα πολυγωνική μορφή του περιοδοδιαγράμματος. Αυτό οφείλεται στο ότι έχουν γίνει συγκρίσεις της χρονοσειράς μας με λίγες ημιτονοειδείς χρονοσειρές. Μπορούμε ν' αυξήσουμε το πλήθος τους «παίζοντας» με την παράμετρο `ofac`. Εδώ θα κάνουμε τη σύγκριση με 100 ημιτονοειδείς χρονοσειρές και θα έχουμε έτσι ένα πιο λείο περιοδόγραμμα.

```{r}
lsp(massExt, from = 5, to = 25, type = "period",
    ofac = 100, alpha = 0.05)
```

Ας κάνουμε μια παρόμοια μελέτη για τους γάμους.


```{r}
lsp(gamoiSynolo)
```

Εδώ το περιοδόγραμμα αρνείται κάθε ενδεχόμενο επαναληπτικότητας. Αυτό οφείλεται στο ότι το εν λόγω γράφημα εντοπίζει καθαρή επαναληπτικότητα, μη αναμεμειγμένη με πτωτικές ή ανωδικές τάσεις, όπως και είναι η χρονοσειρά των γάμων.

### Προσδιορισμός περιόδου και συχνότητας

Στην υπονενότητα αυτή θα χρησιμοποιήσουμε το περιοδόγραμμα για να εντοπίζουμε την περίοδο

```{r}
prosdiorismosPerSyxn <- function(dedomena, apo = NULL, eos = NULL){
  periodogramma <- lsp(dedomena, times = NULL, from = apo, to = eos, type = "period",
      ofac = 130, alpha = 0.01, normalize="press", plot = FALSE)
  per <- periodogramma$peak.at[1]
  syxn <- periodogramma$peak.at[2]
  Period <- c(per)
  Frequency <- c(syxn)
  data.frame(Period,Frequency)
}
```

```{r}
prosdiorismosPerSyxn(massExt, 4, 15)
prosdiorismosPerSyxn(massExt, 4, 10)
prosdiorismosPerSyxn(massExt, 10, 15)
```

```{r}
prosdiorismosPerSyxn(gamoiSynolo, 3, 10)
```



## Προσέγγιση περιοδικής χρονοσειράς με σειρά Fourier

Γιατί σειρά Fourier;

$\dfrac{\operatorname{d}^2 y}{\operatorname{d} t}=-\alpha (y-y_0)$

$y=c_1 \cos \left(t\sqrt{a} \right)+c_2 \sin \left(t\sqrt{a} \right)+y_0$

```{r}
seiraFourier <- function(t,dedomena, listPeriod){
  n <- length(listPeriod)
  T <- listPeriod[1]
  seira <- paste(c("I(sin(2*pi*t/",T,"))+I(cos(2*pi*t/",T,"))"), collapse="")
  if (n>1) {
    for (i in 2:n) {
    T <- listPeriod[i]
    orosN <- paste(c("I(sin(2*pi*t/",T,"))+I(cos(2*pi*t/",T,"))"), collapse="")
    seira <- paste(c(seira,orosN), collapse="+")
  }
  }
  formula_string <- paste("dedomena ~", seira)
  lm_model <- lm(as.formula(formula_string))
  lm_model
}
```

```{r}
n <- length(SeasonalMassExt)
seiraFourier(1:n,SeasonalMassExt,c(6,12))
plot(SeasonalMassExt)
```


```{r}
tt <- (1:100)
Fs <- function(tt){
  10+ 6*sin( (2*pi/6) * tt)-4*cos( (2*pi/6) * tt)+100*sin( (2*pi/7) * tt)+2*cos( (2*pi/3) * tt)
}

dd <- Fs(tt)
```

```{r}
seiraFourier(tt,dd,c(6,7,3))
```




```{r}
plot(tt,dd)
curve(Fs, from=0,to=50)
acf(dd)
```


```{r}
lsp(dd, from = 5, to = 10, type = "period")
```















