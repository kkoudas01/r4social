---
title: "χ2 έλεγχος για την ανεξαρτησία"
author: "Κώστας Κούδας"
cache: TRUE
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
```

```{r, echo=F}
rm(list = ls())
```

# Από πίνακα συχνοτήτων

Στην παρούσα ενότητα θα εξετάσουμε αν δύο μεταβλητές είναι ανεξάρτητες. Συγκεκριμένα, αντλήσαμε στοιχεία από τη σελίδα του [FBI](https://ucr.fbi.gov/nibrs/2018/tables/data-tables) που αφορούν τη σχέση του θύματος στο εκάστοτε έγκλημα με τον θύτη του. Για παράδειγμα βλέπουμε [εκεί](https://ucr.fbi.gov/nibrs/2018/tables/pdfs/relationship_of_victims_to_offenders_by_offense_category_2018.pdf/at_download/file) ότι 25105 σεξουαλικές επιθέσεις γίνονται από μέλη της οικογένειας, ενώ μόνο 6796 γίνονται από αγνώστους.

Τα στοιχεία αυτά αποθηκεύτηκαν σε ένα αρχείο ονόματι egklUSA2018.xlsx.

```{r echo = F, results='asis', message=FALSE}
if(!require(readxl)){
    install.packages("readxl")
    library(readxl)
}
egklUSA2018 <- readxl::read_excel("egklUSA2018.xlsx")
knitr::kable(egklUSA2018) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "100%", height = "200px")
```

Θέλουμε να δούμε αν σε ένα έγκλημα η σχέση του θύματος με τον θύτη και το είδος του εγκλήματος είναι ανεξάρτητα πράγματα.

-   Θέλουμε να δούμε, δηλαδή, αν η γνώση του είδους του εγκλήματος προσφέρει κάτι στην γνώση της σχέσης θύματος-θύτη. Π.χ. αν έχει γίνει μια σεξουαλική επίθεση, κάνει πιο πιθανό να είναι ο δράστης της οικογενείας, σε σχέση με το να γινόταν κάποιο άλλο έγκλημα, όπως π.χ. η ληστεία; Ή μήπως το είδος του εγκλήματος αφήνει ανεπηρέαστη την πιθανότητα ο δράστης να είναι της οικογενείας;

-   Και αντίστροφα: Θέλουμε να δούμε αν η γνώση της σχέσης θύματος-θύτη προσφέρει κάτι στη γνώση του εγκλήματος. Αν π.χ. τελέσει ένα έγκλημα ένας άγνωστος στο θύμα θύτης, κάνει πιο πιθανό αυτό το έγκλημα να είναι μια ληστεία, σε σχέση με το να ήταν ο θύτης μέλος της οικογενείας; Ή μήπως η σχέση θύματος-θύτη αφήνει ανεπηρέαστη την πιθανότητα να είναι το έγκλημα ληστεία; Ορίζουμε ως μηδενική υπόθεση το ότι οι μεταβλητές «σχέση με το θύμα» και «είδος εγκλήματος» είναι ανεξάρτητες και θα δούμε κατά πόσον αυτή θα απορριφθεί, οπότε τελικά θα αποδειχθεί ότι δεν ήταν ανεξάρτητες.

Ο πίνακάς μας είναι σχεδόν σε βολική μορφή, διότι:

-   η κάθε στήλη αποτελείται από τις συχνότητες των εγκλημάτων με βάση τη σχέση με το θύμα,

-   η κάθε γραμμή αποτελείται τις συχνότητες των εγκλημάτων με βάση το είδος του εγκλήματος.

Είναι <u>σχεδόν</u> σε βολική μορφή, διότι περιέχει και στήλη με μη-αριθμητικά δεδομένα, κι αυτή είναι η 1η. Συνεπώς, για να έχουμε στήλες μόνο με αριθμητικά δεδομένα, γράφουμε:

```{r}
egklUSA <- egklUSA2018[ , c("Family Member", "Family Member and Other", "Known to Victim and Other", "Stranger")]
```

Οπότε έτσι έχει πεταχτεί εκτός η πρώτη στήλη.

```{r echo = F, results='asis', message=FALSE}
knitr::kable(egklUSA) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "100%", height = "200px")
```

Τέλος γράφουμε:

```{r}
chisq.test(egklUSA)
```

Η p-τιμή είναι πάρα πολύ μικρή. Αυτό σημαίνει ότι η μηδενική υπόθεση απορρίπτεται, διότι διαφορετικά η πιθανότητα να τύχουμε κάτι τέτοιο θα είναι λιγότερο από 1 στα 1000000000000000. Άρα οι μεταβλητές «σχέση με το θύμα» και «είδος εγκλήματος» <u>δεν</u> είναι ανεξάρτητες.

Δηλαδή:

-   Αν π.χ. έχει γίνει μια σεξουαλική επίθεση επηρεάζεται η πιθανότητα ο θύτης να είναι άγνωστος, σε σχέση με το αν ξέραμε ότι έχει γίνει ληστεία. Με άλλα λόγια, κάποια εγκλήματα κάνουν πιο πιθανό να είναι ο θύτης άγνωστος, σε σχέση με κάποια άλλα.

-   Ή, αν π.χ. τελέσει ένα έγκλημα ένας άγνωστος στο θύμα θύτης, επηρεάζεται η πιθανότητα το έγκλημα αυτό να ήταν ληστεία, σε σχέση με το αν ξέραμε ότι ήταν σεξουαλική παρενόχληση. Με άλλα λόγια, κάποιοι θύτες κάνουν πιο πιθανό ένα έγκλημα, σε σχέση με κάποιους άλλους θύτες.

Συνολικά, ο λιγοστός κώδικας που γράψαμε ήταν ο κάτωθι:

```{r, eval=F}
egklUSA <- egklUSA2018[ , c("Family Member", "Family Member and Other", "Known to Victim and Other", "Stranger")]
chisq.test(egklUSA)
```



# Από πίνακα δεδομένων

```{r, echo=F}
rm(list = ls())
```

Εδώ θα χρησιμοποιήσουμε έναν πίνακα άλλης μορφής. Θα χρησιμοποιήσουμε τα στατιστικά στοιχεία του [Freie Universität](https://www.fu-berlin.de/en/) που τα αποθηκεύσαμε σε ένα αρχείο ονόματι students.xlsx. Παραθέτουμε τις πρώτες 100 καταχωρήσεις του πίνακα, για λόγους ταχύτητας εκτέλεσης του κώδικα.

```{r echo = F, results='asis', message=FALSE}
if(!require(readxl)){
    install.packages("readxl")
    library(readxl)
}
students <- readxl::read_excel("students.xlsx")
knitr::kable(head(students,n=100)) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "100%", height = "200px")
```

Εδώ, όπως βλέπει κι ο αναγνώστης, δεν μας δίνονται οι συχνότητες πχ των αγοριών ή των κοριτσιών. Έχουμε μια λίστα με φοιτητές κι από δίπλα τα προσωπικά, βιολογία και ακαδημαϊκά χαρακτηριστικά του καθενός.

Ας υποθέσουμε, λοιπόν, ότι θέλουμε να εξετάσουμε αν το φύλο και η θρησκεία είναι ανεξάρτητες μεταβλητές. Δηλαδή η γνώση του θρησκεύματος ενός φοιτητή δίνει κάποιες πληροφορίες για το αν αυτός είναι αγόρι ή μήπως όχι; Ή η γνώση του φύλου του φοιτητή κάνει πιο πιθανό είναι αυτός π.χ. μουσουλμάνος;

Γράφουμε:

```{r}
chisq.test(students$gender, students$religion)
```

Βρίσκουμε ότι η p-τιμή είναι 0.1713, δηλαδή μεγαλύτερη από το 0.05 που διαλέγουμε συνήθως ως επίπεδο σημαντικότητας. Επομένως δεν μπορούμε να απορρίψουμε τη μηδενική υπόθεση.

Βλέπουμε δηλαδή ότι η ανεξαρτησία των μεταβλητών «φύλο» και «θρησκεία» δεν μπορεί να απορριφθεί, αν θέλουμε να είμαστε αρκετά αυστηροί. Η p-τιμή που βρήκαμε δείχνει ότι τέτοια δείγματα σαν αυτό που διαχειριζόμαστε τώρα είναι κα΄τα 17.13% πιθανό να επιλεγούν στην περίπτωση που το φύλο και η θρησκεία ήταν ανεξάρτητα. Δηλαδή δεν μιλάμε για κάτι τόσο απίθανο να συμβεί, που να μας κάνει να παραδεχτούμε ότι κάτι άλλο πέραν της τύχης συμβαίνει.

Συνολικά χρησιμοποιήσαμε τον παρακάτω κώδικα:

```{r, eval=F}
chisq.test(students$gender, students$religion)
```







