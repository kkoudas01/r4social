---
title: "Βασικά εργαλεία"
author: "Κώστας Κούδας"
cache: TRUE
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
```

```{r, echo=F}
rm(list = ls())
```

#   Εισαγωγή

Οι χρονικές σειρές είναι σειρές δεδομένων που περιέχουν παρατηρήσεις που σχετίζονται με τον χρόνο. Μελετώντας τις χρονικές σειρές μπορούμε να απαντήσουμε σε ερωτήσεις όπως «Πώς εξελίσσονται τα δεδομένα με την πάροδο του χρόνου;» και μπορούμε να αποκαλύψουμε τάσεις, εποχικότητες, ανωμαλίες και άλλα ποιοτικά χαρακτηριστικά που αντανακλούν τη δυναμική της συγκεκριμένης χρονικής σειράς.

Χρονικές σειρές θα συναντήσουμε σε πολλούς τομείς, όπως η οικονομία, η μετεωρολογία, η δημόσια υγεία, τα χρηματοοικονομικά κ.τ.λ. Οι ανάλυση των χρονικών σειρών μπορεί να παράσχει εισηγήσεις για τη λήψη αποφάσεων, τον προγραμματισμό, την πρόβλεψη και τον εντοπισμό προτύπων στα θέματα αυτά.

#   Καταχώρηση χρονοσειράς

Στην ενότητα αυτή θα μελετήσουμε την εξέλιξη των προστριβών ανάμεσα στην Ελλάδα και την Τουρκία τα έτη 2009-2020, όπως παρουσιάζονται από τα στατιστικά του ΓΕΕΘΑ. Τα στοιχεία έχουν αποθηκευτεί σε ένα αρχείο ονόματι enaerParab.xlsx.

```{r echo = F, results='asis', message=FALSE}
if(!require(readxl)){
    install.packages("readxl")
    library(readxl)
}
enaerParab <- readxl::read_excel("enaerParab.xlsx")
knitr::kable(enaerParab) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "100%", height = "200px")
```

Θα πρέπει να μετρατραπούν σε χρονικές σειρές κι αυτό θα γίνει με τη συνάρτηση `ts(📝📝📝, start =📒📒📒, frequency =⏱⏱⏱)`. Ας τη δούμε πιο συγκεκριμένα:

*   Στη θέση του `📝📝📝` θα βάλουμε τις στήλες από τα δεδομένα μας, των οποίων μάς απασχολεί η χρονική εξέλιξη. Εμείς εδώ ενδιαφερόμαστε για τις παραβάσεις των Κανόνων Εναέριας Κυκλοφορίας, τις παραβιάσεις του Εθνικού Εναέριου Χώρου και τις υπερπτήσεις υπεράνω εθνικού χερσαίου εδάφους, επομένως θέλουμε τις στήλες 3, 4 και 7, οπότε στη θέση αυτή θα γράψουμε `enaerParab[ , c(3,4,7)]`.
*   Παρατηρούμε ότι οι καταγραφές είναι ανά μήνα, δηλαδή στο έτος έχουμε 12 καταγραφές. Αυτό σημαίνει ότι στη θέση του `⏱⏱⏱` θα πάει το 12. Αν είχαμε εποχικές καταγραφές, π.χ. Ανοιξη, Καλοκαίρι, Φθινόπωρο, Χειμώνας, τότε θα γράφαμε 4.
*   Στη θέση του `📒📒📒` θα πάει το σημείο που αρχίζει η πρώτη καταγραφή. Εμείς έχουμε πρώτη καταγραφή τον Ιανουάριο του 2009, οπότε θα γράψουμε `c(2009, 1)`, αφού ο Ιανουάριος είναι ο 1ος μήνας του χρόνου. Αν οι καταγραφές άρχιζαν τον Μάρτιο, τότε   θα γράφαμε `c(2009, 3)`. Από την άλλη, αν είχαμε καταγραφές ανά εποχή, τότε:
    +   θα γράφαμε `c(2009, 1)` αν η πρώτη καταγραφή συνέβαινε Ιανουάριο, Φεβρουάριο ή Μάρτιο,
    +   θα γράφαμε `c(2009, 2)` αν η πρώτη καταγραφή συνέβαινε Απρίλιο, Μάιο ή Ιούνιο,
θα γράφαμε c(2009, 3) αν η πρώτη καταγραφή συνέβαινε Ιούλιο, Αύγουστο, ή Σεπτέμβριο και
    +   θα γράφαμε `c(2009, 4)` αν η πρώτη καταγραφή συνέβαινε Οκτώβριο, Νοέμβριο ή Δεκέμβριο.
  
Οπότε γράφουμε:

```{r}
parab_xs <- ts(enaerParab[ , c(3,4,7)], start = c(2009, 1), frequency = 12)
```

Τέλος, ας υποθέσουμε ότι θέλουμε να κρατήσουμε στοιχεία μόνο για τα έτη 2010-2018. Μπορούμε να κόψουμε από τη χρονική σειρά μας το τμήμα που επιθυμούμε μέσω της συνάρτησης `window(📡📡📡 , start = ⚠️⚠️⚠️, end = 🛑🛑🛑)`. Συγκεκριμένα:

-   στη θέση του `📡📡📡` θα βάλουμε τις χρονικές σειρές που έχουμε, δηλαδή εδώ θα γράψουμε το `parab_xs`,

-   στη θέση του `⚠️⚠️⚠️` θα γράψουμε από πού θέλουμε ν’ αρχίζει η καταγραφή, δηλαδή εδώ στο 2010 και

-   στη θέση του `🛑🛑🛑` γράφουμε πού θέλουμε να σταματάει η καταγραφή, δηλαδή εν προκειμένω στο 2018.

Γράφουμε λοιπόν:

```{r}
parab_xs_10.18 <- window(parab_xs, start = 2010, end = 2018)
```

#   Χρονοδιαγράμματα

##    Συνήθη χρονοδιαγράμματα

Μια πρώτη παρουσίαση των δεδομένων μας μπορεί να γίνει με τη συνάρτηση `plot()` που έχουμε [ξαναδεί](diagramSysxet.html):

```{r}
plot(parab_xs)
```

Μπορούμε να έχουμε μια ομορφότερη και πιο συμμαζευμένη παρουσίαση χρησιμοποιώντας τη συνάρτηση `autoplot()`, όρισμα της οποίας θα είναι τα χρονικά δεδομένα που έχουμε φτιάξει. Αυτή όμως χρειάζεται το πακέτο `forecast`, οπότε πρώτα γράφουμε:

```{r, message=F}
if(!require(forecast)){
    install.packages("forecast")
    library(forecast)
}
```

Έχουμε δηλαδή:

```{r}
autoplot(parab_xs)
```

Κι έτσι προκύπτουν τα κάτωθι χρονοδιαγράμματα των παραβάσεων των Κανόνων Εναέριας Κυκλοφορίας, των παραβιάσεων του Εθνικού Εναέριου Χώρου και των υπερπτήσεων υπεράνω εθνικού χερσαίου εδάφους με διαφορετικό χρόμα το κάθε ένα.

Μπορούμε να αλλάξουμε λίγο τη μορφή παρουσίασής τους, γράφοντας:

```{r}
autoplot(parab_xs, facets = TRUE)
```

Οπότε έχουμε έτσι τρία ξεχωριστά χρονοδιαγράμματα μαζί.

Αξίζει να δούμε πώς παρουσιάζονται τα περικομμένα δεδομένα μας, τα `parab_xs_10.18`, γράφοντας:

```{r}
autoplot(parab_xs_10.18)
```

Βλέπουμε εδώ καθαρά ότι ο καταγεγραμμένος χρόνος εκτείνεται στα έτη 2010-2018, όπως και θέλαμε.

##    Εποχικά χρονοδιαγράμματα

Ας εστιάσουμε τώρα στις εμπλοκές που έχουν γίνει. Γράφουμε καταρχάς:

```{r}
parab_xs_empl <- ts(enaerParab[ , 6], start = c(2009, 1), frequency = 12)
```

ώστε να έχουμε τους αριθμούς των εμπλοκών ως χρονοσειρά. Επιλέξαμε την 6η στήλη, διότι εκεί βρίσκονται οι εμπλοκές.

Το σύνηθες χρονογράφημα δεν παρουσιάζει καμία έκπληξη.

```{r}
autoplot(parab_xs_empl)
```

Είναι ό,τι ξέραμε και πριν, απλά με ένα μόνο χρονοδιάγραμμα, αφού έχουμε μόνο μία στήλη να παρουσιάσουμε.

Εστιάζοντας μόνο σε κάποια δεδομένα, τις εμπλοκές εν προκειμένω, μπορούμε να έχουμε μεγαλύτερη ποικιλία γραφημάτων. Επί παραδείγματι, ας γράψουμε:

```{r}
ggseasonplot(parab_xs_empl)
```

Έχουμε την μηνιαία εξέλιξη των εμπλοκών για κάθε έτος ξεχωριστά. Δηλαδή το ένα χρονοδιάγραμμα δείχνει πώς εξελίσσονταν οι εμπλοκές το έτος 2009, το άλλο δείχνει πώς εξελίσσονταν το 2010 κ.τ.λ.

Η αλήθεια είναι ότι δεν είναι πολύ κατανοητό ποια γραμμή αντιστοιχεί σε ποιο έτος. Αυτό διορθώνεται γράφοντας:

```{r}
ggseasonplot(parab_xs_empl, year.labels=TRUE)
```

Οπότε το κάθε χρονοδιάγραμμα έχει από δίπλα το έτος που του αντιστοιχεί.

Ένα μειονέκτημα που έχει αυτή η παρουσίαση είναι ότι δεν φαίνεται καλά η εξέλιξη της κατάστασης από έτος σε έτος. Είναι καλή για να δούμε το κάθε έτος ξεχωριστά, αλλά για μια παράλληλη σύγκριση όλων των ετών δεν βολεύει πολύ. Προς τούτο μπορούμε να γράψουμε εναλλακτικά:

```{r}
ggseasonplot(parab_xs_empl, continuous=TRUE)
```

Έτσι, η πορεία των εμπλοκών από έτος σε έτος φαίνεται καλύτερα μέσω της διαβάθμισης των χρωμάτων. Βέβαια, είναι πλέον δύσκολο να δούμε ποια γραμμή αντιστοιχεί σε ποιο έτος, φαίνεται όμως ευκρινέστερα η ετήσια εξέλιξη. Κάτι κερδίζεις, κάτι χάνεις σ’ αυτή τη ζωή.

Πέραν της κλασσικής μορφής χρονοδιαγράμματος, έχουμε και το πολικό διάγραμμα. Αυτό δημιουργείται γράφοντας:

```{r}
ggseasonplot(parab_xs_empl, polar = T)
```

Έτσι, οι εμπλοκές παρουσιάζονται να εξελίσσονται στο χρόνο περιστρεφόμενες γύρο από ένα κέντρο, όπως οι δείκτες του ρολογιού. Κάθε ακτίνα αντιστοιχεί σε κάποιον μήνα κι η απόσταση από το κέντρο αντιστοιχεί στο πλήθος των εμπλοκών: ήτοι πολλές εμπλοκές σημαίνει μεγάλη απόσταση, ενώ λίγες εμπλοκές σημαίνει μικρή απόσταση.

Τέλος θα δούμε ένα λίγο-πολύ αντίστροφης λογικής διάγραμμα. Γράφουμε:

```{r}
ggsubseriesplot(parab_xs_empl)
```

Έχουμε, λοιπόν, 12 χρονοδιαγράμματα, ένα για κάθε μήνα. Έτσι, το 1ο χρονοδιάγραμμα που αντιστοιχεί στον Ιανουάριο, δείχνει την ετήσια πορεία των εμπλοκών κατά τον μήνα Ιανουάριο στο κάθε έτος. Δείχνει, δηλαδή, πώς ήταν οι εμπλοκές τον Ιανουάριο του κάθε έτους. Με άλλα λόγια, δείχνει πώς εξελισσόταν ο Ιανουάριος από έτος σε έτος. Τα ίδια μπορούμε να πούμε και για το 2ο χρονοδιάγραμμα που αφορά τον Φεβρουάριο κ.τ.λ.

Οι μπλε γραμμές παρουσιάζουν τις μέσες τιμές για κάθε μήνα. Δηλαδή η 1η μπλε γραμμή υποδηλώνει πόσες κατά μέσο όρο εμπλοκές γινόντουσαν τον Ιανουάριο κατά τα έτη που ασχολούμαστε. Η 2η μπλε γραμμή δείχνει τη μέση τιμή των εμπλοκών που συνέβαιναν τον Φεβρουάριο κατά τα έτη που χειριζόμαστε εδώ κ.τ.λ.

Όλος ο κώδικας που γράψαμε παρατίθεται μαζεμένος παρακάτω:

```{r, eval=F}
parab_xs <- ts(enaerParab[ , c(3,4,7)], start = c(2009, 1), frequency = 12)
parab_xs_10.18 <- window(parab_xs, start = 2010, end = 2018)
plot(parab_xs)
if(!require(forecast)){
    install.packages("forecast")
    library(forecast)
}
autoplot(parab_xs)
autoplot(parab_xs, facets = TRUE)
autoplot(parab_xs_10.18)
parab_xs_empl <- ts(enaerParab[ , 6], start = c(2009, 1), frequency = 12)
autoplot(parab_xs_empl)
ggseasonplot(parab_xs_empl)
ggseasonplot(parab_xs_empl, year.labels=TRUE)
ggseasonplot(parab_xs_empl, continuous=TRUE)
ggseasonplot(parab_xs_empl, polar = T)
ggsubseriesplot(parab_xs_empl)
```











