---
title: "Μέτρα ασυμμετρίας"
author: "Κώστας Κούδας"
cache: TRUE
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
```

# Συντελεστής ασυμμετρίας του Pearson

Στην ενότητα αυτή θα μελετήσουμε το μέσο ημερήσιο κόστος μιας υγιεινούς διατροφής σε κάθε χώρα το 2021 και το μέσο ετήσιο κόστος για φαγητό σε κάθε χώρα το ίδιο έτος.

Προς τούτο θα χρησιμοποιήσουμε δεδομένα από το [Our World in Data](https://ourworldindata.org/), τα οποία έχουμε αποθηκεύσει σε δύο αρχεία, τα costHealthyDiet.csv και foodExpenditureYear.csv, αφού πρώτα διαγράψουμε τις μεταβλητές των προηγούμενων κεφαλαίων.

```{r}
rm(list = ls())
```

```{r echo = F, results='asis', message=FALSE}
costHealthyDiet <- read.csv("costHealthyDiet.csv")
knitr::kable(costHealthyDiet) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "max-content", height = "200px")
```

```{r echo = F, results='asis', message=FALSE}
foodExpenditureYear <- read.csv("foodExpenditureYear.csv")
knitr::kable(foodExpenditureYear) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "max-content", height = "200px")
```

Αρχικά συλλέγουμε τα στοιχεία για το 2021 από το ένα και το άλλο αρχείο, με τον τρόπο που μάθαμε [Επιλογή στοιχείων πίνακα](pinakes.html#2_Επιλογή_στοιχείων_πίνακα). Οπότε γράφουμε:

```{r}
kostos2021 <- costHealthyDiet[costHealthyDiet$Year == 2021, ]
kost2021 <- kostos2021$Cost.of.a.healthy.diet
fagito2021 <- foodExpenditureYear[foodExpenditureYear$Year == 2021, ]
fag2021 <- fagito2021$Total.food.expenditure
```


Ακολούθως κάνουμε τα ιστογράμματα (βλ. ενότητα [Ιστόγραμμα](histogram.html)) για να οπτικοποιήσουμε τα δεδομένα μας:

```{r}
hist(kost2021)
hist(fag2021)
```

Παρατηρούμε ότι το πρώτο ιστόγραμμα είναι λίγο πιο κεντραρισμένο, ενώ το δεύτερο θα λέγαμε ότι έχει μαζευτεί προς τ’ αριστερά. Αυτό σημαίνει ότι οι περισσότερες χώρες ξοδεύουν λίγα χρήματα ετησίως για φαγητό (ίσως επειδή δεν μπορούν, ίσως κι επειδή δεν έχουν), ενώ από την άλλη το κόστος του υγιεινού φαγητού είναι σχεδόν συμμετρικά απλωμένο γύρω από το μέσο κόστος. Πώς όμως θα μπορούσαμε να διαγνώσουμε αυτή τη συμμετρία και την ασυμμετρία χωρίς το ιστόγραμμα; Αυτή τη δουλειά την κάνει ο **συντελεστής ασυμμετρίας του Pearson**. Ας δούμε πώς μας βοηθάει να σχηματίσουμε άποψη:

–   <mark>Όσο εγγύτερα είναι ο συντελεστής ασυμμετρίας του Pearson στο 0, τόσο περισσότερο οι τιμές είναι συμμετρικά κατανεμημένες γύρω από τη μέση τιμή.</mark>

–   <mark>Αρνητικός συντελεστής ασυμμετρίας του Pearson σημαίνει ότι οι περισσότερες τιμές θα είναι μαζεμένες στα δεξιά και θα υπάρχει μια «ουρά» από σπάνιες τιμές στα αριστερά.</mark>

–   <mark>Θετικός συντελεστής ασυμμετρίας του Pearson σημαίνει ότι οι περισσότερες τιμές θα είναι μαζεμένες στα αριστερά και θα υπάρχει μια «ουρά» από σπάνιες τιμές στα δεξιά.</mark>

Πιο συγκεκριμένα, θεωρούμε ότι κοντά στο 0 είναι οι τιμές ±0.5, ±0.4, ±0.3, ±0.2, ±0.1 και, φυσικά, το 0. Αν τύχει κάποια από αυτές, τότε οι μετρήσεις μας έχουν συμμετρία. Διαφορετικά θα έχουν την ασυμμετρία που δηλώνει το πρόσημο και μάλιστα τόσο εντονότερη όσο περισσότερο απόμακρος είναι απ’ το 0 ο εν λόγω συντελεστής.

Στο σημείο αυτό θα πρέπει να επισημάνουμε ότι υπάρχουν διάφοροι συντελεστές ασυμμετρίας. Του Pearson, μάλιστα, είναι δύο. Όμως, αυτός για τον οποίο ισχύουν αυτά που είπαμε στην προηγούμενη παράγραφο είναι ένας συγκεκριμένος συντελεστής, που ή δεν υπάρχει διαθέσιμος στην R ή ο γράφων δεν τον έχει βρει. Έτσι, για να υπολογίσουμε τώρα στην R τον συντελεστή ασυμμετρίας του Pearson θα κατασκευάσουμε μια συνάρτηση ονόματι `asimetriaP`:

```{r}
asimetriaP <- function(v){
  3*(mean(v)-median(v))/sd(v)
}
```

Ακολούθως, για να υπολογίσουμε του συντελεστές που θέλαμε, γράφουμε:

```{r}
asimetriaP(kost2021)
asimetriaP(fag2021)
```

Οπότε μάς εξάγονται οι τιμές `r asimetriaP(kost2021)` και `r asimetriaP(fag2021)` αντίστοιχα, πράγμα που επιβεβαιώνει αυτά που διαπιστώναμε με τα μάτια μας από τα ιστογράμματα.

# Γραφήματα

## Ιστόγραμμα με θηκόγραμμα

Είδαμε στην προηγούμενη ενότητα ότι το ιστόγραμμα είναι μια καλή αφετηρία, για να δούμε γραφικά την ασυμμετρία που μπορεί να έχει ένα σύνολο δεδομένων. Θα ήταν πολύ πιο χρήσιμο, αν μαζί με αυτό υπήρχε κι ένα θηκόγραμμα (βλ. υποενότητα [Θηκόγραμμα](metradiasporas.html#4_Θηκόγραμμα)), που να δείχνει πού είναι συγκεντρωμένη η μεγάλη μάζα των δεδομένων. Προς τούτο θα χρειαστούμε το πακέτο `packHV`, οπότε γράφουμε:

```{r}
if(!require(packHV)){
    install.packages("packHV")
    library(packHV)
}
```

Ακολούθως, για να σχηματίσουμε να επιθυμητά ιστογράμματα-θηκογράμματα, γράφουμε:

```{r}
hist_boxplot(kost2021)
hist_boxplot(fag2021)
```

Παρατηρώντας τα απομονωμένα σημεία (βλ. υποενότητα [Απομονωμένα σημεία](metradiasporas.html#21_Απομονωμένα_σημεία)) αλλά και την όχι κεντραρισμένη γραμμή της διαμέσου (βλ.ενότητα [Διάμεσος](metrathesis.html#2_Διάμεσος)) βλέπουμε λιγάκι πιο καθαρά τώρα ότι τα ημερήσια κόστη είναι σχεδόν συμμετρικά κατανεμημένα γύρω από τη μέση τιμή, αλλά στην πραγματικότητα όχι τόσο, όσο πιστεύαμε ενδεχομένως μόνο από το ιστόγραμμα. Στα δε ετήσια κόστη φαίνεται η ασυμμετρία ακόμα καθαρότερα παρατηρώντας από το θηκόγραμμα ότι το κεντρικό 50% των δεδομένων μας βρίσκεται κοντά στις μικρές τιμές.

## Γράφημα ασυμμετρίας

Η αλήθεια είναι ότι ένα νούμερο δεν μπορεί να αποτυπώσει αξιόπιστα την όποια ασυμμετρία. Εξ ου και υπάρχουν διάφοροι συντελεστές ασυμμετρίας. Εξ ου και ανατρέχουμε στα γραφήματα. Ένα γράφημα φτιαγμένο γι’ αυτήν ακριβώς τη δουλειά είναι το γράφημα ασυμμετρίας. Το εν λόγω γράφημα αντιστοιχεί:

-   τη μέγιστη απόσταση από τη διάμεσο των στοιχείων που είναι μικρότερα αυτής, στη μέγιστη απόσταση από τη διάμεσο των στοιχείων που είναι μεγαλύτερα αυτής,

-   την αμέσως επόμενη σε μέγεθος απόσταση από τη διάμεσο των στοιχείων που είναι μικρότερα αυτής, στην αμέσως επόμενη σε μέγεθος απόσταση από τη διάμεσο των στοιχείων που είναι μεγαλύτερα αυτής,

-   κ.ο.κ.

Το γράφημα ασυμμετρίας μοιάζει πολύ με το γράφημα Q-Q, που θα δούμε πιο μετά, αλλά δεν είναι το ίδιο. Αυτό είναι εξειδικευμένο στο να ανιχνεύει τη συμμετρία, ενώ το Q-Q στο να ανιχνεύει αποκλίσεις από την κανονική ή άλλες κατανομές. Πάντως, και σ’ αυτή την περίπτωση, το «κλειδί» είναι να είναι το γράφημα σχεδόν ευθεία γραμμή. Άπαξ και είναι ευθεία γραμμή, τα δεδομένα μας είναι συμμετρικά.

Δυστυχώς, δεν υπάρχει έτοιμη συνάρτηση γι’ αυτό το σκοπό στην , οπότε θα φτιάξουμε εμείς μία, την `graf_symmetrias`:

```{r}
graf_symmetrias <-  function(x)  {
  n = length(x)
  n2 = n %/% 2
  sx = sort(x)
  mx = median(x)
  plot(mx - sx[1:n2], rev(sx)[1:n2] - mx,
       xlab = "Distance Below Median",
       ylab = "Distance Above Median")
  abline(a = 0, b = 1, lty = "dotted")
}
```

Και ας δρούμε πώς αυτή δρα στις διάφορες περιπτώσεις συμμετρίας ή ασυμμετρίας.

```{r, echo=F}
par(mfrow = c(1,2))
set.seed(1)
symmetricCenter <- rnorm(1000)
hist_boxplot(symmetricCenter)
graf_symmetrias(symmetricCenter)
mtext("Υπάρχει συμμετρία (1)", side = 3, line = - 1.3, outer = TRUE, cex = 1.5)
```

```{r, echo=F}
par(mfrow = c(1,2))
nn <- 1e3
set.seed(1)
betas<-rbeta(nn,2,2)
symmetricBimodal <- c(betas[1:(nn/2)]*2+1,
          betas[(nn/2+1):nn]*2+3)
hist_boxplot(symmetricBimodal)
graf_symmetrias(symmetricBimodal)
mtext("Υπάρχει συμμετρία (2)", side = 3, line = - 1.3, outer = TRUE, cex = 1.5)
```

```{r, echo=F}
par(mfrow = c(1,2))
set.seed(1)
rightSkewed <- rexp(1000,2)
hist_boxplot(rightSkewed)
graf_symmetrias(rightSkewed)
mtext("Δεν υπάρχει συμμετρία (συσσώρευση στα αριστερά)", side = 3, line = - 1.3, outer = TRUE, cex = 1.5)
```

```{r, echo=F}
par(mfrow = c(1,2))
set.seed(1)
leftSkewed <- 1.5-rexp(1000,5)
hist_boxplot(leftSkewed)
graf_symmetrias(leftSkewed)
mtext("Δεν υπάρχει συμμετρία (συσσώρευση στα δεξιά)", side = 3, line = - 1.3, outer = TRUE, cex = 1.5)
```

Επιστρέφουμε στο παράδειγμά μας και γράφουμε:

```{r}
graf_symmetrias(kost2021)
graf_symmetrias(fag2021)
```

Παρατηρούμε πλέον καθαρά ότι δεν έχει συμμετρία κανένα από τα δύο σύνολα δεδομένων. Και πάλι, βέβαια, φαίνεται να είναι τα ημερήσια κόστη λίγο πιο κοντά στο να είναι συμμετρικά σε σχέση με ετήσια έξοδα, αλλά όπως και να ‘χει η απόκλιση από τη συμμετρία είναι ηλίου φαεινότερη και στα δύο.

Όλος ο κώδικας είναι ο παρακάτω:

```{r,eval=F}
rm(list = ls())
kostos2021 <- costHealthyDiet[costHealthyDiet$Year == 2021, ]
kost2021 <- kostos2021$`Cost of a healthy diet`
fagito2021 <- foodExpenditureYear[foodExpenditureYear$Year == 2021, ]
fag2021 <- fagito2021$`Total food expenditure`
hist(kost2021)
hist(fag2021)
asimetriaP <- function(v){
  3*(mean(v)-median(v))/sd(v)
}
asimetriaP(kost2021)
asimetriaP(fag2021)
if(!require(packHV)){
    install.packages("packHV")
    library(packHV)
}
hist_boxplot(kost2021)
hist_boxplot(fag2021)
graf_symmetrias <-  function(x)  {
  n = length(x)
  n2 = n %/% 2
  sx = sort(x)
  mx = median(x)
  plot(mx - sx[1:n2], rev(sx)[1:n2] - mx,
       xlab = "Distance Below Median",
       ylab = "Distance Above Median")
  abline(a = 0, b = 1, lty = "dotted")
}
graf_symmetrias(kost2021)
graf_symmetrias(fag2021)
```

















