---
title: "Περιγραφική Στατιστική"
author: "Κώστας Κούδας"
cache: TRUE
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
```

# Μελέτη συχνότητας

## Συχνότητες

### Πίνακες συχνοτήτων από πρωτογενή δεδομένα

Από την σελίδα του Τομέα Μαθηματικών ΣΕΜΦΕ ΕΜΠ αντλήσαμε τις [βαθμολογίες κάποιων φοιτητών](http://www.math.ntua.gr/~loulakis/info/probabF12SHMMY_files/ProbabSHMMY2012grades.pdf) του ΕΜΠ στο μάθημα Θεωρία Πιθανοτήτων και Στατιστική κατά την εξεταστική του Φεβρουαρίου του 2013. Τις περάσαμε σε ένα αρχείο Excel κι έχουμε διαθέσιμο το αρχείο *bathmoi.xlsx*. Αυτό το εισάγουμε στην R σύμφωνα με τις οδηγίες που έχουμε δει στην υποενότητα Αρχεία Excel (.xls, .xlsx) της [Εισαγωγή αρχείων από άλλα προγράμματα](pinakes.html#13_Εισαγωγή_αρχείων_από_άλλα_προγράμματα), αφού πρώτα διαγράψαμε ό,τι είχαμε εισάγει μέχρι τώρα στην R:

```{r}
rm(list = ls())
```

```{r echo = F, results='asis', message=FALSE}
if(!require(readxl)){
    install.packages("readxl")
    library(readxl)
}
bathmoi <- readxl::read_excel("bathmoi.xlsx")
knitr::kable(bathmoi) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "100%", height = "200px")
```

Φυσικά, οι Αριθμοί Μητρώου (στήλες `ΑΜ`) δεν έχουν κανένα στατιστικό ενδιαφέρον, οπότε θα κρατήσουμε μόνο τους βαθμούς (στήλες `BATHMOS`) γράφοντας:

```{r}
bathmoi_synolo <- c(bathmoi$BATHMOS...2,
                    bathmoi$BATHMOS...4,
                    bathmoi$BATHMOS...6,
                    bathmoi$BATHMOS...8,
                    bathmoi$BATHMOS...10,
                    bathmoi$BATHMOS...12)
```

Έτσι έχουμε μια λίστα με τις βαθμολογίες μας, ονόματι `bathmoi_synolo`. Το πλήθος τους μπορούμε να το βρούμε μέσω της συνάρτησης `length()`. Έτσι, εκτελώντας την εντολή:

```{r}
length(bathmoi_synolo)
```

διαπιστώνουμε ότι έχουμε `r length(bathmoi_synolo)` βαθμολογίες.

Βέβαια, αν το δούμε προσεκτικά τον πίνακα bathmoi, διαπιστώνουμε υπάρχουν κάποιες τιμές που δεν είναι βαθμολογίες. Είναι τα **`NA`** (*Not Avaliable*) που προέκυψαν επειδή οι δύο τελευταίες στήλες του αρχικού πίνακα είναι κοντύτερες από τις υπόλοιπες. Τα NA τα απορρίπτουμε από τη λίστα γράφοντας:

```{r}
bathmoi_synolo <- na.omit(bathmoi_synolo)
```

Έτσι έχουμε τον πίνακα `bathmoi_synolo` χωρίς τα **`NA`**. Πάμε τώρα να υπολογίσουμε πάλι το πλήθος των καταγραφών μας:

```{r}
length(bathmoi_synolo)
```

Εδώ η απάντηση είναι `r length(bathmoi_synolo)` βαθμολογίες, όπερ σημαίνει πως απορρίφθηκαν από την αρχική λίστα `bathmoi_synolo` 5 **`NA`**.

Με μια πρόχειρη ανάγνωση του πίνακα βλέπουμε ότι κάποιοι βαθμοί (πχ το 1) είναι αρκετά συχνοί και κάποιοι άλλοι (πχ το 9) αρκετά σπάνιοι. Οδηγούμεστε, λοιπόν, στους κάτωθι ορισμούς.

|                                   <mark>απόλυτη συχνότητα</mark>                                    |                                    <mark>σχετική συχνότητα</mark>                                    |
|:----------------------------------:|:----------------------------------:|
| <mark>Η **απόλυτη συχνότητα** μιας τιμής μιας μεταβλητής είναι το πλήθος των εμφανίσεών της.</mark> | <mark>Η **σχετική συχνότητα** μιας τιμής μιας μεταβλητής είναι το ποσοστό των εμφανίσεών της.</mark> |

Πώς όμως μπορούν αυτές οι συχνότητες να υπολογιστούν μέσω της; Η δουλειά θα γίνει μέσω των συναρτήσεων `table()` και `prop.table()`. Γράφοντας:

```{r}
ApolSyxnBathm <- table(bathmoi_synolo)
ApolSyxnBathm
```

έχουμε τον πίνακα απόλυτων συχνοτήτων των βαθμολογιών που καταγράψαμε. Παρατηρούμε ότι όντως ο βαθμός 1 έχει πολύ μεγάλη συχνότητα (62 φοιτητές έγραψαν μονάδα), ενώ ο 9 είναι αρκετά πιο σπάνιος (10 μόνο φοιτητές έγραψαν 9).

Για τον πίνακα σχετικών συχνοτήτων γράφουμε:

```{r}
SxetSyxnBathm <- prop.table(ApolSyxnBathm)
SxetSyxnBathm
```

Παρατηρούμε ότι τα ποσοστά δίνονται με τη μορφή δεκαδικού αριθμού (η υποδιαστολή γράφεται ως τελεία). Έτσι διαπιστώνουμε ότι η σχετική συχνότητα του βαθμού 1 είναι περίπου 0.1636, άρα το 16,36% των φοιτητών έγραψε μονάδα. Από την άλλη, το άριστα (10) έχει σχετική συχνότητα περίπου 0.0106. Επομένως μόνο το 1,06% των εξεταζομένων έγραψαν άριστα.

Οι δυνατότητες της συνάρτησης `table()` δεν σταματάνε εδώ. Γράφοντας:

```{r}
arista <- table(bathmoi_synolo>=8.5)
arista
```

προκύπτει ένας πίνακας όπου μας λέει πόσοι έγραψαν άριστα (`TRUE`=14) και πόσοι όχι (`FALSE`=365).

Ενώ αν θέλουμε αυτούς που έγραψαν λίαν καλώς δεν έχουμε παρά να γράψουμε:

```{r}
LianKalos <- table(bathmoi_synolo>=6.5 & bathmoi_synolo<8.5)
LianKalos
```

οπότε βλέπουμε ότι 45 έγραψαν λίαν καλώς και 334 κάτι άλλο (ανώτερο ή κατώτερο).

Στην περίπτωση που θέλουμε να μεταχειριστούμε τον έναν ή τον άλλον πίνακα με όσα μάθαμε στις ενότητες [Επιλογή στοιχείων πίνακα](pinakes.html#2_Επιλογή_στοιχείων_πίνακα), [Προσθήκη στοιχείων σε πίνακα](pinakes.html#3_Προσθήκη_στοιχείων_σε_πίνακα) και [Αναδιαμόρφωση πίνακα](pinakes.html#4_Αναδιαμόρφωση_πίνακα), τότε χρησιμοποιούμε τη συνάρτηση `as.data.frame.table()`. Για παράδειγμα, αν θέλουμε ν’ ασχοληθούμε με τον πίνακα απόλυτων συχνοτήτων `ApolSyxnBathm`, τότε γράφουμε:

```{r}
ASBdataframe <- as.data.frame.table(ApolSyxnBathm)
```

```{r echo = F, results='asis', message=FALSE}
knitr::kable(ASBdataframe) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "max-content", height = "200px")
```

κι έτσι έχουμε τον πίνακα στη μορφή που να μας βολεύει. Δεν είναι το ζήτημα εμφανισιακο. Απλώς έχουμε περισσότερες δυνατότητες πάνω του από προγραμματιστικής απόψεως στην R.

### Από πίνακα απόλυτων συχνοτήτων σε σχετικών

Σε πολλές περιπτώσεις μπορεί να μην έχουμε πρόσβαση στα πρωτογενή δεδομένα, στις άμεσες μετρήσεις πάνω στο δείγμα μας. Μπορεί να έχουμε απλά έναν πίνακα συχνοτήτων, όπως τον `ASBdataframe`, χωρίς όμως να έχουμε πρόσβαση στα προηγούμενα στοιχεία που τον κατασκεύασαν. Πώς μπορούμε να έχουμε τότε τον πίνακα σχετικών συχνοτήτων;

Γράφοντας:

```{r eval = F}
SxetSyxnBathm2 <- prop.table(ASBdataframe)
```

καταλήγουμε στο κάτωθι σφάλμα:

```         
Error in FUN(X[[i]], ...) : 
  only defined on a data frame with all numeric-alike variables
```

διότι, πολύ απλά, η R δεν καταλαβαίνει ότι η στήλη `Freq` του `ASBdataframe` αναπαριστά συχνότητες. Απόλυτα λογικό εκ μέρους της. Θα μπορούσε η στήλη αυτή να είναι τα ύψη από κάποιους ανθρώπους ή οτιδήποτε άσχετο με συχνότητες.

Ως εκ τούτου το βάρος της δημιουργίας του πίνακα σχετικών συχνοτήτων πέφτει πάνω μας. Αλλά δεν πρόκειται για δύσκολο εγχείρημα. Η σχετική συχνότητα είναι η απόλυτη συχνότητα δια το συνολικό πλήθος των μετρήσεων. Έτσι υπολογίζουμε αρχικά το συνολικό πλήθος των μετρήσεων προσθέτοντας απλά όλες τις συχνότητες (βλ. [Νέα λίστα](pinakes.html#22_Νέα_λίστα) και [Κατασκευή λίστας ή πίνακα τιμών στην R](pinakes.html#12_Κατασκευή_λίστας_ή_πίνακα_τιμών_στην_R)):

```{r}
athrisma <- sum(ASBdataframe$Freq)
```

και ακολούθως διαιρούμε κάθε στοιχείο της στήλης `Freq` με το `athrisma` και συγχρόνως επισυνάπτοντας την κατασκευασθείσα λίστα ως νέα στήλη ονόματι `SxetSyxn` σύμφωνα με αυτά που μάθαμε στην υποενότητα Προσθήκη στήλης της [Προσθήκη στοιχείων σε πίνακα](pinakes.html#3_Προσθήκη_στοιχείων_σε_πίνακα):

```{r}
ASBdataframe$SxetSyxn <- (ASBdataframe$Freq)/athrisma
```

Οπότε γράφοντας:

```{r, eval=F}
View(ASBdataframe)
```

έχουμε έναν πίνακα απόλυτων και σχετικών συχνοτήτων.

```{r echo = F, results='asis', message=FALSE}
knitr::kable(ASBdataframe) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "max-content", height = "200px")
```

Συνολικά ο κώδικά μας είναι ο κάτωθι:

```{r, eval =F}
rm(list = ls())
bathmoi_synolo <- c(bathmoi$BATHMOS...2,
                    bathmoi$BATHMOS...4,
                    bathmoi$BATHMOS...6,
                    bathmoi$BATHMOS...8,
                    bathmoi$BATHMOS...10,
                    bathmoi$BATHMOS...12)
length(bathmoi_synolo)
bathmoi_synolo <- na.omit(bathmoi_synolo)
length(bathmoi_synolo)
ApolSyxnBathm <- table(bathmoi_synolo)
ApolSyxnBathm
SxetSyxnBathm <- prop.table(ApolSyxnBathm)
SxetSyxnBathm
arista <- table(bathmoi_synolo>=8.5)
arista
LianKalos <- table(bathmoi_synolo>=6.5 & bathmoi_synolo<8.5)
LianKalos
ASBdataframe <- as.data.frame.table(ApolSyxnBathm)
athrisma <- sum(ASBdataframe$Freq)
ASBdataframe$SxetSyxn <- (ASBdataframe$Freq)/athrisma
View(ASBdataframe)
```

## Μέτρηση ποικιλομορφίας

### Ποικιλότητα Shannon

Στην παρούσα ενότητα θα προσπαθήσουμε να μετρήσουμε τον πλουραλισμό και την πολυφωνία σε μια ομάδα. Αρχικά, βέβαια, διαγράφουμε ό,τι έχουμε γράψει ως τώρα.

```{r}
rm(list = ls())
```

Ας υποθέσουμε ότι ένα σωματείο έχει συνέλευση, στην οποία παραβρίσκονται 150 άτομα που πρόσκεινται στη ΝΔ (*μπλε*), 120 άτομα που πρόσκεινται στον ΣΥΡΙΖΑ (*ροζ*), 100 άτομα στο ΠΑΣΟΚ (*πράσινο*) και 90 στο ΚΚΕ (*κόκκινο*). Αναπαριστούμε με την παρακάτω εικόνα την εν λόγω συνέλευση.

```{r, echo = F, message = F}
if(!require(ggplot2)){
    install.packages("ggplot2")
    library(ggplot2)
}
num_blue <- 150
num_pink <- 120
num_green <- 100
num_red <- 90

# Δημιουργία τυχαίων θέσεων για κάθε χρώμα
blue_points <- data.frame(x = runif(num_blue), y = runif(num_blue))
pink_points <- data.frame(x = runif(num_pink), y = runif(num_pink))
green_points <- data.frame(x = runif(num_green), y = runif(num_green))
red_points <- data.frame(x = runif(num_red), y = runif(num_red))

# Δημιουργία του γραφήματος
plot1 <- ggplot() +
  geom_point(data = blue_points, aes(x, y), color = "blue") +
  geom_point(data = pink_points, aes(x, y), color = "pink") +
  geom_point(data = green_points, aes(x, y), color = "green") +
  geom_point(data = red_points, aes(x, y), color = "red") +
  xlim(0, 1) + ylim(0, 1) +  # Ορισμός των ορίων της ορθογώνιας περιοχής
  theme(axis.text.x = element_blank(), axis.text.y = element_blank(),  # Αφαίρεση των αριθμών των άξονων
        axis.title.x = element_blank(), axis.title.y = element_blank())  # Αφαίρεση των ενδείξεων x και y

plot1
```

Το σωματείο φαίνεται να έχει όλη τη γκάμα των πολιτικών αποχρώσεων. Δεν μπορούμε να πούμε ότι κάποιο πολιτικό κόμμα έχει μόνο τυπική παρουσία στο σωματείο.

Αντίθετα, στο παρακάτω σωματείο φαίνεται να υπάρχει μικρότερη ποικιλία απόψεων. Σε αυτό παραβρίσκονται 290 άτομα που πρόσκεινται στη ΝΔ (*μπλε*), 60 άτομα που πρόσκεινται στον ΣΥΡΙΖΑ (*ροζ*), 50 άτομα στο ΠΑΣΟΚ (*πράσινο*) και 40 στο ΚΚΕ (*κόκκινο*).

```{r, echo = F, message = F}
if(!require(ggplot2)){
    install.packages("ggplot2")
    library(ggplot2)
}
num_blue <- 290
num_pink <- 60
num_green <- 50
num_red <- 40

# Δημιουργία τυχαίων θέσεων για κάθε χρώμα
blue_points <- data.frame(x = runif(num_blue), y = runif(num_blue))
pink_points <- data.frame(x = runif(num_pink), y = runif(num_pink))
green_points <- data.frame(x = runif(num_green), y = runif(num_green))
red_points <- data.frame(x = runif(num_red), y = runif(num_red))

# Δημιουργία του γραφήματος
plot1 <- ggplot() +
  geom_point(data = blue_points, aes(x, y), color = "blue") +
  geom_point(data = pink_points, aes(x, y), color = "pink") +
  geom_point(data = green_points, aes(x, y), color = "green") +
  geom_point(data = red_points, aes(x, y), color = "red") +
  xlim(0, 1) + ylim(0, 1) +  # Ορισμός των ορίων της ορθογώνιας περιοχής
  theme(axis.text.x = element_blank(), axis.text.y = element_blank(),  # Αφαίρεση των αριθμών των άξονων
        axis.title.x = element_blank(), axis.title.y = element_blank())  # Αφαίρεση των ενδείξεων x και y

plot1
```

Σε αυτό φαίνεται να έχει μονοκρατορία η ΝΔ. Η ποικιλία απόψεων είναι μόνο σε τυπικό επίπεδο, αφού η παρουσία των υπολοίπων είναι πρακτικά ασήμαντη.

Γενικότερα, όσο λιγότερα είδη φέρει ένας πληθυσμός, τόσο μικρότερη ποικιλότητα έχει. Κι όσο περισσότερο μονοπωλεί τον πληθυσμό ένα είδος, τόσο επίσης λιγότερη ποικιλότητα έχει. Πώς όμως μπορώ να μετρήσω αυτή την ποικιλότητα;

Ευτυχώς για μας, δεν χρειάζεται να βασιζόμαστε μόνο στη διαίσθησή μας. Υπάρχει τρόπος να ορίσουμε τόσο αυστηρά την ποικιλότητα, ώστε να μπορεί να προσδιοριστεί με έναν αριθμό. Όσο μεγαλύτερος είναι αυτός, τόσο μεγαλύτερη και η ποικιλότητα. Αυτός είναι η λεγόμενη **ποικιλότητα Shannon**.

Εδώ δεν θα ασχοληθούμε, φυσικά, με υποθετικά σωματεία. Θα εξετάσουμε την ποικιλότητα της ελληνικής εκλογικής σκηνής στις αναμετρήσεις του 1996 και του 2000. Προς τούτο αντλήσαμε στοιχεία από τη σελίδα του Υπουργείου Εσωτερικών και τ’ αποθηκεύσαμε σε ένα αρχείο ονόματι *ekloges9600.xlsx* ακολουθώντας τις οδηγίες από την ενότητα [Εισαγωγή αρχείων από άλλα προγράμματα](#εισαγωγή-αρχείων-από-άλλα-προγράμματα).

```{r echo = F, results='asis', message=FALSE}
if(!require(readxl)){
    install.packages("readxl")
    library(readxl)
}
ekloges9600 <- readxl::read_excel("ekloges9600.xlsx")
knitr::kable(ekloges9600) %>%
  kable_styling("striped", full_width = F) %>%
  scroll_box(width = "max-content", height = "200px")
```

Για να βρούμε την ποικιλότητα του κάθε εκλογικού τοπίου χρειαζόμαστε τις συχνότητες των κομμάτων που το αποτελούν. Αυτές θα επεξεργαστεί η R για να βρει την ποικιλότητα Shannon. Δυστυχώς, η R δεν έχει έτοιμη συνάρτηση που να υπολογίζει την εν λόγω ποσότητα. Εν πάση περιπτώσει, ο γράφων δεν έχει υπ’ όψιν κάτι τέτοιο. Αισίως, όμως, υπάρχει η δυνατότητα να κατασκευάσουμε τα δικά μας εργαλεία στην R.

Παρακάτω ακολουθεί η συνάρτηση που υπολογίζει την ποικιλότητα Shannon από μια λίστα με συχνότητες (απόλυτες ή σχετικές). Οποτεδήποτε την χρειαστούμε επικολλούμε τις γραμμές αυτές ακριβώς ως έχουν πριν από το σημείο που θα την χρησιμοποιήσουμε. Ακολούθως γράφουμε `shannon_diversity(♔)`, όπου `♔` το όνομα της λίστας με τις συχνότητες.

```{r}
shannon_diversity <- function(my_freq) {
  s <- sum(my_freq)
  temp <- my_freq/s
  sh <- -sum(temp*log2(temp))
  sh
}
```

Ακολούθως αποσπούμε τα κομμάτια της στήλης `psifoi` που μας απασχολούν. Θα φτιάξουμε μια λίστα με τις ψήφους του 1996 (`psifoi1996`) και μία με τις ψήφους του 2000 (`psifoi1996`). Ακολουθώντας τις οδηγίες της υποενότητας [Νέος πίνακας](pinakes.html#21_Νέος_πίνακας) έχουμε:

```{r}
etos1996 <- ekloges9600$etos == 1996
psifoi1996 <- ekloges9600[etos1996,"psifoi"]
etos2000 <- ekloges9600$etos == 2000
psifoi2000 <- ekloges9600[etos2000,"psifoi"]
```

Οι ποικιλότητες Shannon υπολογίζονται πλέον απλά γράφοντας:

```{r}
shannon_diversity(psifoi1996)
shannon_diversity(psifoi2000)
```

οπότε βρίσκουμε για το 1996 ποικιλότητα `r shannon_diversity(psifoi1996)` και για το 2000 ποικιλότητα `r shannon_diversity(psifoi2000)`. Επομένως τα αποτελέσματα του 1996 είχαν μεγαλύτερη ποικιλομορφία συγκριτικά με του 2000.

Ο αναγνώστης θα έχει τώρα την εύλογη απορία «Και πόσο μεγαλύτερη είναι η ποικιλότητα το 1996; Είναι οι 0,2968306 μονάδες διαφορά τόσο μεγάλη;». Θα χρησιμοποιήσουμε τον τροποποιημένο πίνακα από [εδώ](https://www.researchgate.net/publication/339064707_Ecological_services_of_agroforestry_systems_in_selected_upland_farming_communities_in_the_Philippines/figures?lo=1), για να δούμε πόσο μεγάλη είναι η κάθε ποικιλότητα:

|  Τιμή ποικιλότητας   | Αξιολόγηση ποικιλότητας |
|:--------------------:|:-----------------------:|
|    5,049 και πάνω    |       Πολύ υψηλή        |
|    4,328 με 5,048    |          Υψηλή          |
|    3,607 με 4,327    |          Μέση           |
|    2,885 με 3,606    |         Χαμηλή          |
| 2,884 και χαμηλότερα |       Πολύ χαμηλή       |

Βλέπουμε, λοιπόν, ότι και στις δύο εκλογικές αναμετρήσεις είχαμε πολύ χαμηλή ποικιλότητα. Η σύγκρισή τους όμως ακόμα δεν είναι εφικτή. Πρέπει να δουλέψουμε κι άλλο!

### Ισομέρεια Shannon {#ισομέρεια-shannon}

Ένας τρόπος, λοιπόν, να απαντήσουμε αυτή την απορία είναι συγκρίνοντας τις εκάστοτε ποικιλότητες με τη μέγιστη δυνατή ανά περίπτωση.

Η μέγιστη δυνατή ποικιλότητα συμβαίνει όταν όλα τα είδη είναι ισόποσα στον πληθυσμό. Αυτή μπορεί να υπολογιστεί μέσω της συνάρτησης:

```{r}
shannon_diversity_max <- function(my_freq) {
  sh <- log2(length(my_freq))
  sh
}
```

Γράφοντας όμως:

```{r}
shannon_diversity_max(psifoi1996)
shannon_diversity_max(psifoi2000)
```

προκύπτει ότι η μέγιστη ποικιλότητα είναι μηδέν, οπότε καταλαβαίνουμε ότι κάτι δεν πάει καλά με τον κώδικά μας. Αυτό το πρόβλημα προκύπτει επειδή τα `psifoi1996` και `psifoi2000` στην πραγματικότητα είναι πίνακες με μία στήλη κι όχι λίστες. Ναι, είναι διαφορετικό για την R, αλλά αυτόν της τον ψυχαναγκασμό μπορούμε να τον αντιμετωπίσουμε μέσω της σύνθεσης της συνάρτησης `unlist`:

```{r}
psifoi1996L <- unlist(psifoi1996)
psifoi2000L <- unlist(psifoi2000)
```

Έτσι, υπολογίζουμε την μέγιστη ποικιλότητα των **λιστών** `psifoi1996L` και `psifoi1996L`:

```{r}
shannon_diversity_max(psifoi1996L)
shannon_diversity_max(psifoi2000L)
```

οπότε βρίσκουμε ότι η μέγιστη δυνατή ποικιλότητα το 1996 θα ήταν `r shannon_diversity_max(psifoi1996L)` και το 2000 θα ήταν επίσης `r shannon_diversity_max(psifoi2000L)`.

Αυτό που βρήκαμε δεν είναι καθόλου παράξενο, αφού και στις δύο περιπτώσεις είχαμε `r length(psifoi1996L)` κόμματα, πράγμα που διαπιστώνουμε με τον παρακάτω κώδικα:

```{r}
length(psifoi1996L)
length(psifoi2000L)
```

Η αρχική μας ιδέα ήταν να συγκριθεί η κάθε ποικιλότητα με την μέγιστη της άλλης. Αφού, όμως, οι μέγιστες ποικιλότητες είναι ίσες, δεν έχουμε παρά να δούμε τι ποσοστό της μέγιστης ποικιλότητας είναι η κάθε μία ξεχωριστά. Αυτό το ποσοστό είναι η ισομέρεια Shannon και υπολογίζεται από την συνάρτηση:

```{r}
shannon_equitability <- function(my_freq) {
  s <- sum(my_freq)
  temp <- my_freq/s
  shd <- -sum(temp*log2(temp))
  shm <- log2(length(my_freq))
  sh <- shd/shm
  sh
}
```

Κατά συνέπεια, γράφουμε:

```{r}
shannon_equitability(psifoi1996L)
shannon_equitability(psifoi2000L)
```

και διαπιστώνουμε ότι ο δείκτης ισομέρειας το 1996 ήταν `shannon_equitability(psifoi1996L)` και το 2000 ήταν `shannon_equitability(psifoi2000L)`. Απ’ ότι φαίνεται, τελικά, το 1996 υπήρχε εμφανώς μεγαλύτερη ποικιλομορφία στα εκλογικά αποτελέσματα, ενώ το 2000 υπήρξε έντονη συσπείρωση γύρω από τα μεγάλα κόμματα.

Συνολικά ο κώδικας αυτής της ανάρτησης έχει ως εξής:

```{r eval=F}
rm(list = ls())
shannon_diversity <- function(my_freq) {
  s <- sum(my_freq)
  temp <- my_freq/s
  sh <- -sum(temp*log2(temp))
  sh
}
etos1996 <- ekloges9600$etos == 1996
psifoi1996 <- ekloges9600[etos1996,"psifoi"]
etos2000 <- ekloges9600$etos == 2000
psifoi2000 <- ekloges9600[etos2000,"psifoi"]
shannon_diversity(psifoi1996)
shannon_diversity(psifoi2000)
shannon_diversity_max <- function(my_freq) {
  sh <- log2(length(my_freq))
  sh
}
shannon_diversity_max(psifoi1996) # Τα psifoi1996 και psifoi2000 δεν είναι σε κατάλληλη μορφή
shannon_diversity_max(psifoi2000)
psifoi1996L <- unlist(psifoi1996)
psifoi2000L <- unlist(psifoi2000)
shannon_diversity_max(psifoi1996L) # Τα psifoi1996L και psifoi2000L είναι σε κατάλληλη μορφή
shannon_diversity_max(psifoi2000L)
length(psifoi1996L)
length(psifoi2000L)
shannon_equitability <- function(my_freq) {
  s <- sum(my_freq)
  temp <- my_freq/s
  shd <- -sum(temp*log2(temp))
  shm <- log2(length(my_freq))
  sh <- shd/shm
  sh
}
shannon_equitability(psifoi1996L)
shannon_equitability(psifoi2000L)
```

## Κυκλικό διάγραμμα

Υπάρχουν φορές που μπορεί να μην μας απασχολεί τόσο η σύγκριση των συχνοτήτων των τιμών μεταξύ τους, αλλά με το σύνολο. Μπορεί να μας απασχολεί να απεικονίσουμε την σχέση της κάθε εργασιακής κατάστασης μιας γυναίκας (απασχολούμενη, άνεργη, μη ενεργή) σε σχέση με το σύνολο των γυναικών. Δηλαδή να απαντήσουμε στα ερωτήματα «Τι μέρος των γυναικών εργάζονται;», «Τι μέρος των γυναικών είναι άνεργες;» κτλ. Το **κυκλικό διάγραμμα** (ή **πίτα**) είναι ιδανικό γι’ αυτή τη δουλειά.

Όπως ανέκαθεν, διαγράφουμε τις παλιές μεταβλητές και προχωράμε:

```{r}
rm(list = ls())
```

Από τη [Γενική Γραμματεία Ισότητας](https://isotita.gr/wp-content/uploads/2019/04/%CE%A0%CE%B1%CF%81%CE%B1%CF%84%CE%B7%CF%81%CE%B7%CF%84%CE%AE%CF%81%CE%B9%CE%BF-%CE%93%CE%93%CE%99%CE%A6-19%CE%BF-%CE%95%CE%BD%CE%B7%CE%BC%CE%B5%CF%81%CF%89%CF%84%CE%B9%CE%BA%CF%8C-%CE%A3%CE%B7%CE%BC%CE%B5%CE%AF%CF%89%CE%BC%CE%B1-%CE%93%CF%85%CE%BD%CE%B1%CE%B9%CE%BA%CE%B5%CE%AF%CE%B1-%CE%91%CE%BD%CE%B5%CF%81%CE%B3%CE%AF%CE%B1.pdf) αντλούμε κάποιες πληροφορίες σχετικά με την εργασιακή απασχόληση το Δ’ τρίμηνο του 2018 ανά φύλο. Θα φτιάξουμε αρχικά ένα γρήγορο κυκλικό διάγραμμα που να απεικονίζει την εργασιακή κατάσταση των αντρών, δηλαδή να δείχνει πόσοι άντρες είναι απασχολούμενοι, πόσοι άνεργοι και πόσοι μη ενεργοί σε σχέση με το σύνολο των αντρών. Για να γίνει αυτό στην θα χρειαστούμε την λίστα με τα αντίστοιχα νούμερα (`posa`) και φυσικά τι αντιπροσωπεύει το κάθε ένα (`etiketes`):

```{r}
posa <- c(2249.7, 388.3, 1760.6)
etiketes <- c("apasx_antras", "anerg_antras", "mh_energ_antras")
```

Η πίτα είναι έτοιμη να φτιαχτεί:

```{r}
pie(posa, labels = etiketes)
```

Θα κάνουμε κι ένα επιπλέον κυκλικό διάγραμμα που να αφορά τις γυναίκες. Θα μπορούσαμε να την καταχωρήσουμε εύκολα πάλι μέσω της συνάρτησης c(), όμως θα επιλέξουμε να την αντλήσουμε από έναν πίνακα για να δοθεί μια γενικότητα στη μέθοδο και για να φρεσκάρουμε τις τεχνικές που μάθαμε στην υποερνότητα [Νέα λίστα](pinakes.html#22_Νέα_λίστα).

Θα σχηματοποιούμε πίνακα και μετά θα επιχειρήσουμε να αντλήσουμε από αυτόν τις πληροφορίες που θέλουμε. Κατά τα γνωστά (βλ. υποενότητα [Κατασκευή πίνακα](pinakes.html#122_Κατασκευή_πίνακα)) έχουμε:

```{r}
filo <- c("gynaika", "andras")
apasx <- c(1584, 2249.7)
anerg <- c(492.8, 388.3)
mh_energ <- c(2650.9, 1760.6)
```

και τέλος:

```{r}
Apasxolisi <- data.frame(FYLO=filo, APASXOLOYMENOS=apasx, ANERGOS=anerg, MH_ENERGOS=mh_energ)
Apasxolisi
```

όπου τα νούμερα δίνονται σε χιλιάδες.

Από αυτόν τον πίνακα θα πάρουμε τα δεδομένα που χρειαζόμαστε, χωρίς να χρειαστεί να τα εισάγουμε εκ νέου. Έτσι, αρχικά αποκόπτουμε από τον πίνακα `Apasxolisi` το κομμάτι με τις μετρήσεις που μας ενδιαφέρει ν’ απεικονίσουμε στο κυκλικό διάγραμμα:

```{r}
Apasxolisimetr <- Apasxolisi[1 , c(2:4)]
```

Και ακολούθως μετατρέπουμε σε λίστα αυτές τις μετρήσεις (βλ. τον ψυχαναγκασμό της R και στην υποενότητα [Ισομέρεια Shannon](#ισομέρεια-shannon)):

```{r}
apasxG <-   unlist(Apasxolisimetr)
```

κι αποκτάμε την λίστα με τον αριθμό των γυναικών ανά εργασιακή κατάσταση.

Με την εντολή:

```{r}
	katastasi <- colnames(Apasxolisimetr)
```

φτιάχνουμε μια λίστα ονόματι `katastasi`, η οποία περιέχει τους τίτλους από τις στήλες του πίνακα.

Η πίτα είναι έτοιμη να φτιαχτεί! Δίνουμε την εντολή:

```{r}
pie(apasxG, labels = katastasi, main = "Ergasiaki Katastasi")
```

οπότε έχουμε ένα κυκλικό διάγραμμα, που:

-   καταγράφει τα ποσά της λίστας `apasxG`,
-   δίπλα από το κάθε κομμάτι της πίτας έχει ετικέτα τα στοιχεία της λίστας `katastasi` (`labels = katastasi`),
-   έχει τίτλο `Ergasiaki Katastasi` (`main = "Ergasiaki Katastasi`).

Κάποιοι μπορεί να δυσαρεστηθούν από τα ξεθωριασμένα χρώματα της πίτας. Αυτοί θα ικανοποιηθούν με την συνάρτηση `rainbow()`. Γράφοντας σαν παράμετρο της πίτας `col = rainbow(★★★)`θα χρησιμοποιηθούν `★★★` σε πλήθος χρώματα του ουράνιου τόξου για τον χρωματισμό της. Συγκεκριμένα αν γράψουμε:

```{r}
pie(apasxG, labels = katastasi, main = "Ergasiaki Katastasi", col = rainbow(3))
```

θα έχουμε την ίδια πίτα με πριν, απλά θα χρησιμοποιηθούν 3 χρώματα του ουράνιου τόξου για την βαφή της.

Αν θέλουμε να καταγράφονται και τα αντίστοιχα ποσοστά στις ετικέτες, τότε θα χρησιμοποιήσουμε την συνάρτηση `paste()`, για να κολλήσουμε στις ετικέτες (`labels`) τα ποσοστά. Έτσι, αρχικά υπολογίζουμε τα αντίστοιχα ποσοστά:

```{r}
apasxGp <- round(apasxG/sum(apasxG)*100, digits = 2)
```

όπου η συνάρτηση `round()` στρογγυλοποιεί τα αποτελέσματα κρατώντας το πολύ δύο δεκαδικά ψηφία (`digits = 2`). Επίσης τα οποία πολλαπλασιάσαμε με 100, ώστε να μην είναι σε δεκαδική μορφή.

Ακολούθως γράφουμε διαδοχικά:

```{r}
katast_pososta <- paste(katastasi, apasxGp, sep = " ")
katast_pososta <- paste(katast_pososta, "%", sep = "")
```

ώστε:

-   αρχικά να ενωθούν οι ενδείξεις των λιστών `katastasi` και `apasxGp` με κενό ανάμεσά τους (`sep = " "`)
-   και ακολούθως να μπει το σύμβολο «`%`» δίπλα από το αντίστοιχο νούμερο χωρίς κενό ανάμεσά τους (`sep = ""`).

Τέλος, γράφουμε:

```{r}
pie(apasxG,labels = katast_pososta,main = "Ergasiaki Katastasi")
```

κι έχουμε την πίτα με ετικέτες τους προηγούμενους τίτλους μαζί με τα ποσοστά. Προφανώς τα έντονα χρώματα μπορούν να χρησιμοποιηθούν και πάλι μέσω της επιλογής `col = rainbow(3)`.

Συνολικά ο κώδικας που γράψαμε είναι ο κάτωθι:

```{r eval =F}
rm(list = ls())
posa <- c(2249.7, 388.3, 1760.6)
etiketes <- c("apasx_antras", "anerg_antras", "mh_energ_antras")
pie(posa, labels = etiketes)
filo <- c("gynaika", "andras")
apasx <- c(1584, 2249.7)
anerg <- c(492.8, 388.3)
mh_energ <- c(2650.9, 1760.6)
Apasxolisi <- data.frame(FYLO=filo, APASXOLOYMENOS=apasx, ANERGOS=anerg, MH_ENERGOS=mh_energ)
Apasxolisi
Apasxolisimetr <- Apasxolisi[1 , c(2:4)]
apasxG <-   unlist(Apasxolisimetr)
katastasi <- colnames(Apasxolisimetr)
pie(apasxG, labels = katastasi, main = "Ergasiaki Katastasi")
pie(apasxG,labels = katastasi,main = "Ergasiaki Katastasi", col = rainbow(3))
apasxGp <- round(apasxG/sum(apasxG)*100, digits = 2)
katast_pososta <- paste(katastasi,apasxGp,sep = " ")
katast_pososta <- paste(katast_pososta, "%", sep = "")
pie(apasxG,labels = katast_pososta,main = "Ergasiaki Katastasi")
```

## Ραβδόγραμμα

### Απεικόνιση μίας μεταβλητής

### Από λίστα τιμών

Εδώ θ’ ασχοληθούμε πάλι με τα δεδομένα από τη [Γενική Γραμματεία Ισότητας](https://isotita.gr/wp-content/uploads/2019/04/%CE%A0%CE%B1%CF%81%CE%B1%CF%84%CE%B7%CF%81%CE%B7%CF%84%CE%AE%CF%81%CE%B9%CE%BF-%CE%93%CE%93%CE%99%CE%A6-19%CE%BF-%CE%95%CE%BD%CE%B7%CE%BC%CE%B5%CF%81%CF%89%CF%84%CE%B9%CE%BA%CF%8C-%CE%A3%CE%B7%CE%BC%CE%B5%CE%AF%CF%89%CE%BC%CE%B1-%CE%93%CF%85%CE%BD%CE%B1%CE%B9%CE%BA%CE%B5%CE%AF%CE%B1-%CE%91%CE%BD%CE%B5%CF%81%CE%B3%CE%AF%CE%B1.pdf), όπως κάναμε στην ενότητα [Κυκλικό διάγραμμα].

Είναι φανερό ότι το κυκλικό διάγραμμα δεν μπορεί ν’ απεικονίσει ευδιάκριτα μικροδιαφορές που μπορεί να έχουν οι τιμές. Αν, όμως, μας ενδιαφέρει αυτό, αλλά όχι τόσο η σύγκριση με το σύνολο, το ιδανικό είναι το ραβδόγραμμα.

Θα ασχοληθούμε αρχικά με κάτι απλό. Θα φτιάξουμε αρχικά ένα γρήγορο ραβδόγραμμα που να απεικονίζει την εργασιακή κατάσταση των αντρών, δηλαδή να δείχνει πόσοι άντρες είναι απασχολούμενοι, πόσοι άνεργοι και πόσοι μη ενεργοί και οι τιμές να συγκρίνονται εύκολα μεταξύ τους.

Για να γίνει αυτό στην R θα χρειαστούμε την λίστα με τα αντίστοιχα νούμερα (`posa`) και φυσικά τι αντιπροσωπεύει το κάθε ένα (`etiketes`). Μαζί με τη διαγραφή των προηγουμένων έχουμε τις παρακάτω εντολές:

```{r}
rm(list = ls())
posa <- c(2249.7, 388.3, 1760.6)
etiketes <- c("apasx_antras", "anerg_antras", "mh_energ_antras")
```

και το ραβδόγραμμα είναι έτοιμο να φτιαχτεί:

```{r}
barplot(posa, names.arg = etiketes)
```

Πριν προχωρήσουμε σε κάτι άλλο, θα εξετάσουμε κάποιες επιπλέον παραμέτρους της συνάρτησης `barplot()`. Γράφοντας:


```{r}
barplot(posa,
        names.arg = etiketes,
        main = "Apasxolisi stoys antres",
        xlab = "ergasiaki katastasi",
        ylab = "xiliades andron",
        col = "blue",
        density = 10)
```

-   δώσαμε τίτλο στο γράφημά μας τον «Apasxolisi stoys antres» (`main = "Apasxolisi stoys antres"`),
-   δώσαμε τίτλο στον οριζόντιο άξονα «ergasiaki katastasi» (`xlab = "ergasiaki katastasi"`),
-   δώσαμε τίτλο στον κατακόρυφο άξονα «xiliades andron» (`ylab = "xiliades andron"`),
-   χρωματίσαμε μπλε τις μπάρες (`col = "blue"`) και
-   γραμμοσκιάσαμε τις μπάρες (εδώ δώσαμε `density = 10`, αν δίναμε πχ `density = 20`, η γραμμοσκίαση θα ήταν πιο πυκνή).

Ας πειραματιστούμε κι άλλο λίγο με κάποιες άλλες παραμέτρους:

```{r}
barplot(posa,
        names.arg = etiketes,
        main = "Apasxolisi stoys antres",
        xlab = "xiliades andron",
        ylab = "ergasiaki katastasi",
        col = "blue",
        horiz = TRUE)
```

Εδώ:

-   δώσαμε πάλι τίτλο στο γράφημά μας τον «Apasxolisi stoys antres» (`main = "Apasxolisi stoys antres"`)
-   δώσαμε τίτλο στον οριζόντιο άξονα «xiliades andron» (`ylab = "xiliades andron"`),
-   δώσαμε τίτλο στον κατακόρυφο άξονα «ergasiaki katastasi» (`xlab = "ergasiaki katastasi"`),
-   χρωματίσαμε μπλε τις μπάρες (`col = "blue"`),
-   διώξαμε τη γραμμοσκίαση (σβήσαμε την παράμετρο `density`) και
-   κάναμε οριζόντιο το ραβδόγραμμα (`horiz = TRUE`)


### Από πίνακα δεδομένων

Σε αυτό το σημείο θα δούμε και ένα επιπλέον πακέτο της R, το `ggplot2`, που μας επιτρέπει να κάνουμε περισσότερα ακόμα με τα γραφήματά μας. Προς τούτο το εγκαθιστούμε και το φορτώνουμε:

### Απεικόνιση πολλών μεταβλητών

### Διόρθωση σειράς

## Ιστόγραμμα

Να δω και πιο περίτεχνα από PISA

# Μέτρα συσχέτισης {#μέτρα-συσχέτισης}
